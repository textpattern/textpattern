<?php

/*
$HeadURL$
$LastChangedRevision$
*/


if (!defined('TXP_INSTALL'))
	exit;

@ignore_user_abort(1);
@set_time_limit(0);

mysql_connect($dhost,$duser,$dpass,false,$dclient_flags);
mysql_select_db($ddb);

$result = mysql_query("describe `".PFX."textpattern`");
if ($result) die("Textpattern database table already exists. Can't run setup.");


$version = mysql_get_server_info();
//Use "ENGINE" if version of MySQL > (4.0.18 or 4.1.2)
$tabletype = ( intval($version[0]) >= 5 || preg_match('#^4\.(0\.[2-9]|(1[89]))|(1\.[2-9])#',$version))
	? " ENGINE=MyISAM "
	: " TYPE=MyISAM ";

// On 4.1 or greater use utf8-tables
if ( isset($dbcharset) && (intval($version[0]) >= 5 || preg_match('#^4\.[1-9]#',$version)))
{
	$tabletype .= " CHARACTER SET = $dbcharset ";
	if ($dbcharset == 'utf8')
		$tabletype .= " COLLATE utf8_general_ci ";
	mysql_query("SET NAMES ".$dbcharset);
}

// Default to messy URLs if we know clean ones won't work
$permlink_mode = 'section_id_title';
if (is_callable('apache_get_modules'))
{
	$modules = apache_get_modules();
	if (!in_array('mod_rewrite', $modules))
		$permlink_mode = 'messy';
}
else
{
	$server_software = (@$_SERVER['SERVER_SOFTWARE'] || @$_SERVER['HTTP_HOST'])
		? ( (@$_SERVER['SERVER_SOFTWARE']) ?  @$_SERVER['SERVER_SOFTWARE'] :  $_SERVER['HTTP_HOST'] )
		: '';
	if (!stristr($server_software, 'Apache'))
		$permlink_mode = 'messy';
}

$name = ps('name') ? ps('name') : 'anon';

$create_sql = array();

$create_sql[] = "CREATE TABLE `".PFX."textpattern` (
  `ID` int(11) NOT NULL auto_increment,
  `Posted` datetime NOT NULL default '0000-00-00 00:00:00',
  `AuthorID` varchar(64) NOT NULL default '',
  `LastMod` datetime NOT NULL default '0000-00-00 00:00:00',
  `LastModID` varchar(64) NOT NULL default '',
  `Title` varchar(255) NOT NULL default '',
  `Title_html` varchar(255) NOT NULL default '',
  `Body` mediumtext NOT NULL,
  `Body_html` mediumtext NOT NULL,
  `Excerpt` text NOT NULL,
  `Excerpt_html` mediumtext NOT NULL,
  `Image` varchar(255) NOT NULL default '',
  `Category1` varchar(128) NOT NULL default '',
  `Category2` varchar(128) NOT NULL default '',
  `Annotate` int(2) NOT NULL default '0',
  `AnnotateInvite` varchar(255) NOT NULL default '',
  `comments_count` int(8) NOT NULL default '0',
  `Status` int(2) NOT NULL default '4',
  `textile_body` int(2) NOT NULL default '1',
  `textile_excerpt` int(2) NOT NULL default '1',
  `Section` varchar(64) NOT NULL default '',
  `override_form` varchar(255) NOT NULL default '',
  `Keywords` varchar(255) NOT NULL default '',
  `url_title` varchar(255) NOT NULL default '',
  `custom_1` varchar(255) NOT NULL default '',
  `custom_2` varchar(255) NOT NULL default '',
  `custom_3` varchar(255) NOT NULL default '',
  `custom_4` varchar(255) NOT NULL default '',
  `custom_5` varchar(255) NOT NULL default '',
  `custom_6` varchar(255) NOT NULL default '',
  `custom_7` varchar(255) NOT NULL default '',
  `custom_8` varchar(255) NOT NULL default '',
  `custom_9` varchar(255) NOT NULL default '',
  `custom_10` varchar(255) NOT NULL default '',
  `uid` varchar(32) NOT NULL default '',
  `feed_time` date NOT NULL default '0000-00-00',
  PRIMARY KEY  (`ID`),
  KEY `categories_idx` (`Category1`(10),`Category2`(10)),
  KEY `Posted` (`Posted`),
  FULLTEXT KEY `searching` (`Title`,`Body`)
) $tabletype PACK_KEYS=1 AUTO_INCREMENT=2 ";

$setup_comment_invite = doSlash( ( gTxt('setup_comment_invite')=='setup_comment_invite') ? 'Comment' : gTxt('setup_comment_invite') );
$create_sql[] = "INSERT INTO `".PFX."textpattern` VALUES (1, now(), '".doSlash($name)."', now(), '', 'Welcome to Your Site!', '', 'h3. What do you want to do next?\n\n* Modify or even delete this article? The \"article list\":siteurl/textpattern/index.php?event=list is the place to start.\n* Change this site\'s name, or modify the style of the URLs? It\'s all up to your \"preferences\":siteurl/textpattern/index.php?event=prefs.\n* Get yourself acquainted with Textile, the humane web text generator which comes with Textpattern? The basics are \"simple\":http://textpattern.com/textile-sandbox. If you want to learn more about Textile, you can dig into an \"extensive manual\":http://textpattern.com/textile-reference-manual later.\n* Be guided through your \"Textpattern first steps\":http://textpattern.com/textpattern-first-steps by completing some basic tasks?\n* Study the \"Textpattern Semantic Model?\":http://textpattern.com/textpattern-semantic-model\n* Add \"another user\":siteurl/textpattern/index.php?event=admin, or extend the capabilities with \"third party plugins\":siteurl/textpattern/index.php?event=plugin you discovered from the central plugin directory at \"Textpattern Resources\":http://textpattern.org/?\n* Dive in and learn by trial and error? Then please note:\n** When you \"write\":siteurl/textpattern/index.php?event=article an article you assign it to a section of your site.\n** Sections use a \"page template\":siteurl/textpattern/index.php?event=page and a \"style\":siteurl/textpattern/index.php?event=css as an output scaffold.\n** Page templates use XHTML and Textpattern tags (like this: @<txp:article />@) to build the markup.\n** Some Textpattern tags use \"forms\":siteurl/textpattern/index.php?event=form, which are building blocks for reusable snippets of code and markup you may build and use at your discretion.\n\nThere are a host of \"Frequently Asked Questions\":http://textpattern.com/faq/ to help you get started.\n\n\"Textpattern tags\":http://textpattern.com/textpattern-tag-reference, their attributes and values are as well explained as sampled at the \"User Documentation\":http://textpattern.net/, where you will also find valuable tips and tutorials.\n\nIf all else fails, there\'s a whole crowd of friendly, helpful people over at the \"Textpattern support forum\":http://forum.textpattern.com/. Come and pay a visit!\n', '\t<h3>What do you want to do next?</h3>\n\n\t<ul>\n\t\t<li>Modify or even delete this article? The <a href=\"siteurl/textpattern/index.php?event=list\">article list</a> is the place to start.</li>\n\t\t<li>Change this site&#8217;s name, or modify the style of the <span class=\"caps\">URL</span>s? It&#8217;s all up to your <a href=\"siteurl/textpattern/index.php?event=prefs\">preferences</a>.</li>\n\t\t<li>Get yourself acquainted with Textile, the humane web text generator which comes with Textpattern? The basics are <a href=\"http://textpattern.com/textile-sandbox\">simple</a>. If you want to learn more about Textile, you can dig into an <a href=\"http://textpattern.com/textile-reference-manual\">extensive manual</a> later.</li>\n\t\t<li>Be guided through your <a href=\"http://textpattern.com/textpattern-first-steps\">Textpattern first steps</a> by completing some basic tasks?</li>\n\t\t<li>Study the <a href=\"http://textpattern.com/textpattern-semantic-model\">Textpattern Semantic Model?</a></li>\n\t\t<li>Add <a href=\"siteurl/textpattern/index.php?event=admin\">another user</a>, or extend the capabilities with <a href=\"siteurl/textpattern/index.php?event=plugin\">third party plugins</a> you discovered from the central plugin directory at <a href=\"http://textpattern.org/\">Textpattern Resources</a>?</li>\n\t\t<li>Dive in and learn by trial and error? Then please note:\n\t<ul>\n\t\t<li>When you <a href=\"siteurl/textpattern/index.php?event=article\">write</a> an article you assign it to a section of your site.</li>\n\t\t<li>Sections use a <a href=\"siteurl/textpattern/index.php?event=page\">page template</a> and a <a href=\"siteurl/textpattern/index.php?event=css\">style</a> as an output scaffold.</li>\n\t\t<li>Page templates use <span class=\"caps\">XHTML</span> and Textpattern tags (like this: <code>&lt;txp:article /&gt;</code>) to build the markup.</li>\n\t\t<li>Some Textpattern tags use <a href=\"siteurl/textpattern/index.php?event=form\">forms</a>, which are building blocks for reusable snippets of code and markup you may build and use at your discretion.</li>\n\t</ul></li>\n\t</ul>\n\n\t<p>There are a host of <a href=\"http://textpattern.com/faq/\">Frequently Asked Questions</a> to help you get started.</p>\n\n\t<p><a href=\"http://textpattern.com/textpattern-tag-reference\">Textpattern tags</a>, their attributes and values are as well explained as sampled at the <a href=\"http://textpattern.net/\">User Documentation</a>, where you will also find valuable tips and tutorials.</p>\n\n\t<p>If all else fails, there&#8217;s a whole crowd of friendly, helpful people over at the <a href=\"http://forum.textpattern.com/\">Textpattern support forum</a>. Come and pay a visit!</p>', '', '', '', 'hope-for-the-future', 'meaningful-labor', 1, '".$setup_comment_invite."', 1, 4, 1, 1, 'articles', '', '', 'welcome-to-your-site', '', '', '', '', '', '', '', '', '', '', '".md5(uniqid(rand(), true))."', now())";


$create_sql[] = "CREATE TABLE `".PFX."txp_category` (
  `id` int(6) NOT NULL auto_increment,
  `name` varchar(64) NOT NULL default '',
  `type` varchar(64) NOT NULL default '',
  `parent` varchar(64) NOT NULL default '',
  `lft` int(6) NOT NULL default '0',
  `rgt` int(6) NOT NULL default '0',
  `title` varchar(255) NOT NULL default '',
  PRIMARY KEY  (`id`)
) $tabletype PACK_KEYS=1 AUTO_INCREMENT=10 ";

$create_sql[] = "INSERT INTO `".PFX."txp_category` VALUES (1, 'root', 'article', '', 1, 8, 'root')";
$create_sql[] = "INSERT INTO `".PFX."txp_category` VALUES (2, 'root', 'link', '', 1, 4, 'root')";
$create_sql[] = "INSERT INTO `".PFX."txp_category` VALUES (3, 'root', 'image', '', 1, 4, 'root')";
$create_sql[] = "INSERT INTO `".PFX."txp_category` VALUES (4, 'root', 'file', '', 1, 2, 'root')";
$create_sql[] = "INSERT INTO `".PFX."txp_category` VALUES (5, 'hope-for-the-future', 'article', 'root', 2, 3, 'Hope for the Future')";
$create_sql[] = "INSERT INTO `".PFX."txp_category` VALUES (6, 'meaningful-labor', 'article', 'root', 4, 5, 'Meaningful Labor')";
$create_sql[] = "INSERT INTO `".PFX."txp_category` VALUES (7, 'reciprocal-affection', 'article', 'root', 6, 7, 'Reciprocal Affection')";
$create_sql[] = "INSERT INTO `".PFX."txp_category` VALUES (8, 'textpattern', 'link', 'root', 2, 3, 'Textpattern')";
$create_sql[] = "INSERT INTO `".PFX."txp_category` VALUES (9, 'site-design', 'image', 'root', 2, 3, 'Site Design')";


$create_sql[] = "CREATE TABLE `".PFX."txp_css` (
  `name` varchar(255) NOT NULL,
  `css` text NOT NULL,
  UNIQUE KEY `name` (`name`)
) $tabletype ";

$create_sql[] = "INSERT INTO `".PFX."txp_css` VALUES ('default', '/* =============================================================================\r\n   Styling and layout for all media\r\n   ========================================================================== */\r\n\r\n\r\n@media all {\r\n\r\n  /* =============================================================================\r\n     Abridged version of Normalize.css\r\n     ========================================================================== */\r\n  /* original authors: Nicolas Gallagher and Jonathan Neal - http://necolas.github.com/normalize.css/ */\r\n\r\n  /* corrects block display not defined in IE6-9, Firefox3 */\r\n  article,\r\n  aside,\r\n  details,\r\n  figcaption,\r\n  figure,\r\n  footer,\r\n  header,\r\n  hgroup,\r\n  nav,\r\n  section {\r\n    display: block;\r\n  }\r\n\r\n  /* corrects inline-block display not defined in IE6-9, Firefox3 */\r\n  audio,\r\n  canvas,\r\n  video {\r\n    display: inline-block;\r\n    *display: inline;\r\n    *zoom: 1;\r\n  }\r\n\r\n  /* prevents modern browsers from displaying \'audio\' without controls */\r\n  audio:not([controls]) {\r\n    display: none;\r\n  }\r\n\r\n  /* addresses styling for \'hidden\' attribute not present in IE7-9, Firefox3, Safari4 */\r\n  [hidden] {\r\n    display: none;\r\n  }\r\n\r\n  html {\r\n    font-size: 100%;\r\n    /* always force scrollbar padding so we don\'t get \'jumping\' */\r\n    overflow-y: scroll;\r\n    /* prevents iOS text size adjust after orientation change, without disabling user zoom -\r\n        http://www.456bereastreet.com/archive/201012/controlling_text_size_in_safari_for_ios_without_disabling_user_zoom/ */\r\n    -webkit-text-size-adjust: 100%;\r\n    /* as above, for Windows Phone */\r\n    -ms-text-size-adjust: 100%;\r\n  }\r\n\r\n  /* addresses style set to \'bolder\' in Firefox3-4, Safari4-5, Chrome */\r\n  b,\r\n  strong {\r\n    font-weight: bold;\r\n  }\r\n\r\n  /* addresses CSS quotes not supported in IE6-7, addresses quote property not supported in Safari4 */\r\n  q {\r\n    quotes: none;\r\n  }\r\n  q:before, q:after {\r\n    content: \'\';\r\n    content: none;\r\n  }\r\n\r\n  /* prevents sub and sup affecting line-height in all browsers */\r\n  sub,\r\n  sup {\r\n    font-size: 75%;\r\n    line-height: 0;\r\n    position: relative;\r\n    vertical-align: baseline;\r\n  }\r\n\r\n  sup {\r\n    top: -0.5em;\r\n  }\r\n\r\n  sub {\r\n    bottom: -0.25em;\r\n  }\r\n\r\n  /* make table cells align top by default */\r\n  th,\r\n  td {\r\n    vertical-align: top;\r\n  }\r\n\r\n  /* reset default padding on lists */\r\n  ul,\r\n  ol,\r\n  dd {\r\n    padding: 0;\r\n  }\r\n\r\n  /* corrects inner padding and border displayed oddly in Firefox3-4 - www.sitepen.com/blog/2008/05/14/the-devils-in-the-details-fixing-dojos-toolbar-buttons/ */\r\n  ::-moz-focus-inner {\r\n    border: 0;\r\n    padding: 0;\r\n  }\r\n\r\n  /* =============================================================================\r\n     Clearfix\r\n     ========================================================================== */\r\n  /* updated to prevent margin-collapsing on child elements in most situations - http://nicolasgallagher.com/micro-clearfix-hack/ */\r\n\r\n  .clearfix {\r\n    *zoom: 1;\r\n  }\r\n  .clearfix:before, .clearfix:after {\r\n    content: \"\";\r\n    display: table;\r\n  }\r\n  .clearfix:after {\r\n    clear: both;\r\n  }\r\n\r\n}\r\n\r\n\r\n/* =============================================================================\r\n   Styling and layout for screen media > 959px\r\n   ========================================================================== */\r\n\r\n\r\n@media screen {\r\n\r\n  /* =============================================================================\r\n     Layout\r\n     ========================================================================== */\r\n\r\n  body {\r\n    width: 960px;\r\n    margin: 0 auto 20px;\r\n    background: white;\r\n  }\r\n\r\n  header {\r\n    border-left: solid 1px #d4d4d4;\r\n    border-right: solid 1px #d4d4d4;\r\n    padding: 10px 10px 0;\r\n    background: #f0f2f6;\r\n  }\r\n\r\n  nav {\r\n    border: solid 1px #e1a61a;\r\n    border-radius: 0 0 5px 5px;\r\n    background: #ffda44;\r\n    /* Safari4+, Chrome */\r\n    background: -webkit-gradient(linear, left top, left bottom, from(#ffda44), to(#fabc2b));\r\n    /* Safari5.1+, Chrome10+ */\r\n    background: -webkit-linear-gradient(#ffda44, #fabc2b);\r\n    /* Firefox3.6 */\r\n    background: -moz-linear-gradient(#ffda44, #fabc2b);\r\n    /* IE10 */\r\n    background: -ms-linear-gradient(#ffda44, #fabc2b);\r\n    /* Opera11.10+ */\r\n    background: -o-linear-gradient(#ffda44, #fabc2b);\r\n    /* CSS3 Compliant */\r\n    background: linear-gradient(#ffda44, #fabc2b);\r\n    /* IE7-9 */\r\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorStr=\'#ffda44\',EndColorStr=\'#fabc2b\');\r\n  }\r\n  nav h1 {\r\n    display: none;\r\n  }\r\n  nav ul {\r\n    list-style: none;\r\n    list-style-image: none;\r\n    margin: 0;\r\n  }\r\n  nav li {\r\n    float: left;\r\n    margin: 0;\r\n    border-right: solid 1px #e1a61a;\r\n  }\r\n  nav a {\r\n    text-decoration: none;\r\n    text-shadow: 1px 1px #ffe991;\r\n    display: block;\r\n    padding: 10px;\r\n    color: #333333;\r\n  }\r\n  nav a:hover, nav a:active {\r\n    text-decoration: none;\r\n    background: #ffe477;\r\n    /* Safari4+, Chrome */\r\n    background: -webkit-gradient(linear, left top, left bottom, from(#ffe477), to(#fbcc5d));\r\n    /* Safari5.1+, Chrome10+ */\r\n    background: -webkit-linear-gradient(#ffe477, #fbcc5d);\r\n    /* Firefox3.6 */\r\n    background: -moz-linear-gradient(#ffe477, #fbcc5d);\r\n    /* IE10 */\r\n    background: -ms-linear-gradient(#ffe477, #fbcc5d);\r\n    /* Opera11.10+ */\r\n    background: -o-linear-gradient(#ffe477, #fbcc5d);\r\n    /* CSS3 Compliant */\r\n    background: linear-gradient(#ffe477, #fbcc5d);\r\n    /* IE7-9 */\r\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorStr=\'#ffe477\',EndColorStr=\'#fbcc5d\');\r\n  }\r\n\r\n  [role=\"main\"] {\r\n    float: left;\r\n    width: 640px;\r\n    margin: 20px 10px 0;\r\n  }\r\n\r\n  [role=\"complementary\"] {\r\n    float: left;\r\n    margin: 20px 10px;\r\n    border: solid 1px #d4d4d4;\r\n    border-radius: 5px;\r\n    padding: 10px 10px 0;\r\n    width: 258px;\r\n    background: #f0f2f6;\r\n  }\r\n\r\n  footer {\r\n    clear: both;\r\n    border: solid 1px #d4d4d4;\r\n    border-radius: 5px;\r\n    padding: 10px;\r\n    /* declare width to fix for IE7 double padding bug */\r\n    width: 938px;\r\n    background: #f0f2f6;\r\n  }\r\n\r\n  #search-page [role=\"main\"] article:last-of-type {\r\n    margin-bottom: 1em;\r\n  }\r\n\r\n  /* =============================================================================\r\n     Links\r\n     ========================================================================== */\r\n\r\n  a {\r\n    -webkit-tap-highlight-color: rgba(255, 230, 153, 0.5);\r\n    text-decoration: none;\r\n    color: #1a428b;\r\n  }\r\n  a:hover, a:active {\r\n    /* improves readability when focused and also mouse hovered in all browsers - people.opera.com/patrickl/experiments/keyboard/test */\r\n    outline: 0;\r\n  }\r\n\r\n  header a {\r\n    color: #333333;\r\n  }\r\n\r\n  [role=\"main\"] a:hover, [role=\"main\"] a:active,\r\n  [role=\"complementary\"] a:hover,\r\n  [role=\"complementary\"] a:active,\r\n  footer a:hover,\r\n  footer a:active {\r\n    text-decoration: underline;\r\n    color: #1a428b;\r\n  }\r\n  [role=\"main\"] a:visited,\r\n  [role=\"complementary\"] a:visited,\r\n  footer a:visited {\r\n    color: #551a8b;\r\n  }\r\n\r\n  [role=\"main\"] h1 a {\r\n    color: #333333;\r\n  }\r\n  [role=\"main\"] h1 a:visited {\r\n    color: #333333;\r\n  }\r\n  [role=\"main\"] h1 a:hover, [role=\"main\"] h1 a:active {\r\n    text-decoration: none;\r\n    color: #333333;\r\n    background: #f0f2f6;\r\n  }\r\n\r\n  /* =============================================================================\r\n     Typography\r\n     ========================================================================== */\r\n\r\n  body {\r\n    /* 13px / 16px */\r\n    font-size: .8125em;\r\n    /* 19px / 13px */\r\n    line-height: 1.46153846153846em;\r\n    font-family: Verdana, \"Lucida Grande\", Tahoma, Arial, sans-serif;\r\n    color: #333333;\r\n  }\r\n\r\n  h1 {\r\n    /* 39px / 13px */\r\n    font-size: 3em;\r\n    /* 44px / 39px */\r\n    line-height: 1.12820512820513em;\r\n    font-family: \"Helvetica Neue\", Helvetica, Arial, Verdana, sans-serif;\r\n    letter-spacing: -1px;\r\n    margin: 0;\r\n    /* 10px / 39px */\r\n    padding-top: .256410256410256em;\r\n    /* 20px / 39px */\r\n    padding-bottom: .512820512820513em;\r\n  }\r\n\r\n  h2,\r\n  h3 {\r\n    /* 24px / 13px */\r\n    font-size: 1.84615384615385em;\r\n    /* 32px / 24px */\r\n    line-height: 1.33333333333333em;\r\n    font-family: \"Droid Serif\", Georgia, Times, serif;\r\n    font-weight: normal;\r\n    font-style: italic;\r\n    margin: 0;\r\n    /* 13px / 26px */\r\n    padding-bottom: .5em;\r\n  }\r\n\r\n  h4 {\r\n    /* 13px / 13px */\r\n    font-size: 1em;\r\n    margin: 0;\r\n  }\r\n\r\n  p {\r\n    margin: 0;\r\n    /* 13px / 13px */\r\n    padding-bottom: 1em;\r\n  }\r\n\r\n  blockquote {\r\n    font-family: \"Droid Serif\", Georgia, Times, serif;\r\n    font-style: italic;\r\n    float: right;\r\n    margin: 0 0 .5em 1em;\r\n    border-radius: 5px;\r\n    padding: 1em 10px 0;\r\n    width: 260px;\r\n    background: #f0f2f6;\r\n  }\r\n\r\n  dfn,\r\n  q {\r\n    font-family: \"Droid Serif\", Georgia, Times, serif;\r\n    font-style: italic;\r\n    background: #fdf5d9;\r\n  }\r\n\r\n  /* addresses styling not present in IE7-9, Safari5, Chrome */\r\n  abbr[title],\r\n  acronym[title],\r\n  dfn[title] {\r\n    border-bottom: 1px dotted;\r\n    cursor: help;\r\n  }\r\n\r\n  pre,\r\n  code,\r\n  kbd,\r\n  samp,\r\n  var {\r\n    font-family: Cousine, Consolas, Monaco, monospace;\r\n    background: #fdf5d9;\r\n    border-radius: 5px;\r\n  }\r\n\r\n  code,\r\n  kbd,\r\n  samp,\r\n  var {\r\n     padding: 1px 3px;\r\n  }\r\n\r\n  pre {\r\n    margin: 0 0 1.3em;\r\n    padding: 1em 10px;\r\n    overflow-x: auto;\r\n  }\r\n\r\n  mark {\r\n    background: #fdf5d9;\r\n    color: #333333;\r\n    font-style: italic;\r\n    font-weight: bold;\r\n  }\r\n\r\n  small,\r\n  figcaption,\r\n  tfoot,\r\n  .footnote {\r\n    /* 11px / 13px */\r\n    font-size: .84615384615385em;\r\n    /* 15px / 11px */\r\n    line-height: 1.36363636363636em;\r\n  }\r\n\r\n  figcaption,\r\n  tfoot,\r\n  .footnote {\r\n    color: #999999;\r\n  }\r\n\r\n  figcaption {\r\n    font-style: italic;\r\n  }\r\n\r\n  /* =============================================================================\r\n     Embedded content\r\n     ========================================================================== */\r\n\r\n  /* removes border when inside \'a\' element in IE6-9,\r\n      improves image quality when scaled in IE7 - code.flickr.com/blog/2008/11/12/on-ui-quality-the-little-things-client-side-image-resizing/ */\r\n  img {\r\n    border: 0;\r\n    -ms-interpolation-mode: bicubic;\r\n  }\r\n\r\n  /* corrects overflow displayed oddly in IE9 */\r\n  svg:not(:root) {\r\n    overflow: hidden;\r\n  }\r\n\r\n  article img, article embed, article object, article video {\r\n    max-width: 100%;\r\n    margin: 3px 0;\r\n  }\r\n\r\n  figure {\r\n    margin: 0 0 1.3em;\r\n  }\r\n\r\n  /* =============================================================================\r\n     Tables\r\n     ========================================================================== */\r\n\r\n  table {\r\n    margin-bottom: 1.3em;\r\n    border-collapse: collapse;\r\n    border-spacing: 0;\r\n    width: 100%;\r\n  }\r\n\r\n  caption {\r\n    font-family: \"Droid Serif\", Georgia, Times, serif;\r\n    font-style: italic;\r\n    text-align: left;\r\n    margin-bottom: .5em;\r\n  }\r\n\r\n  thead {\r\n    border-right: 1px solid #f0f2f6;\r\n    border-left: 1px solid #f0f2f6;\r\n    background: #f0f2f6;\r\n  }\r\n\r\n  tfoot {\r\n    border-right: 1px solid #f0f2f6;\r\n    border-left: 1px solid #f0f2f6;\r\n    background: #f6f8fa;\r\n  }\r\n\r\n  tbody {\r\n    border-right: 1px solid #f0f2f6;\r\n    border-left: 1px solid #f0f2f6;\r\n  }\r\n\r\n  th,\r\n  td {\r\n    border-bottom: 1px solid #f0f2f6;\r\n    padding: .25em 9px;\r\n  }\r\n\r\n  th {\r\n    text-align: left;\r\n    border-top: 1px solid #f0f2f6;\r\n  }\r\n\r\n  /* =============================================================================\r\n     Lists\r\n     ========================================================================== */\r\n\r\n  [role=\"main\"] ul, [role=\"main\"] ol, [role=\"main\"] dl,\r\n  [role=\"complementary\"] ul,\r\n  [role=\"complementary\"] ol,\r\n  [role=\"complementary\"] dl {\r\n    margin: 0 0 1em 20px;\r\n  }\r\n\r\n  dt {\r\n    font-family: \"Droid Serif\", Georgia, Times, serif;\r\n    font-style: italic;\r\n  }\r\n\r\n  [role=\"complementary\"] #monthly-list {\r\n    list-style: none;\r\n    margin: 0;\r\n    padding: 5px 0 10px;\r\n  }\r\n  [role=\"complementary\"] #monthly-list li {\r\n    text-align: center;\r\n    float: left;\r\n    display: block;\r\n    margin: 0 4px 6px 0;\r\n    min-width: 36px;\r\n    border: 1px solid #d4d4d4;\r\n    border-radius: 5px;\r\n    background: #fff;\r\n    -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\r\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\r\n  }\r\n  [role=\"complementary\"] #monthly-list li:active {\r\n    position: relative;\r\n    top: 1px;\r\n  }\r\n  [role=\"complementary\"] #monthly-list a {\r\n    text-decoration: none;\r\n    color: #333333;\r\n  }\r\n  [role=\"complementary\"] #monthly-list a:hover, [role=\"complementary\"] #monthly-list a:focus {\r\n    color: #1a1a1a;\r\n  }\r\n  [role=\"complementary\"] #monthly-list a .archive-year {\r\n    /* 10px / 13px */\r\n    font-size: .76923076923077em;\r\n    /* 15px / 10px */\r\n    line-height: 1.5em;\r\n    font-weight: bold;\r\n    text-shadow: 1px 1px #ffe991;\r\n    border-radius: 5px 5px 0 0;\r\n    background: #ffda44;\r\n    /* Safari4+, Chrome */\r\n    background: -webkit-gradient(linear, left top, left bottom, from(#ffda44), to(#fabc2b));\r\n    /* Safari5.1+, Chrome10+ */\r\n    background: -webkit-linear-gradient(#ffda44, #fabc2b);\r\n    /* Firefox3.6 */\r\n    background: -moz-linear-gradient(#ffda44, #fabc2b);\r\n    /* IE10 */\r\n    background: -ms-linear-gradient(#ffda44, #fabc2b);\r\n    /* Opera11.10+ */\r\n    background: -o-linear-gradient(#ffda44, #fabc2b);\r\n    /* CSS3 Compliant */\r\n    background: linear-gradient(#ffda44, #fabc2b);\r\n    /* IE7-9 */\r\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorStr=\'#ffda44\',EndColorStr=\'#fabc2b\');\r\n  }\r\n  [role=\"complementary\"] #monthly-list a:hover .archive-year, [role=\"complementary\"] #monthly-list a:focus .archive-year {\r\n    background: #ffe477;\r\n    /* Safari4+, Chrome */\r\n    background: -webkit-gradient(linear, left top, left bottom, from(#ffe477), to(#fbcc5d));\r\n    /* Safari5.1+, Chrome10+ */\r\n    background: -webkit-linear-gradient(#ffe477, #fbcc5d);\r\n    /* Firefox3.6 */\r\n    background: -moz-linear-gradient(#ffe477, #fbcc5d);\r\n    /* IE10 */\r\n    background: -ms-linear-gradient(#ffe477, #fbcc5d);\r\n    /* Opera11.10+ */\r\n    background: -o-linear-gradient(#ffe477, #fbcc5d);\r\n    /* CSS3 Compliant */\r\n    background: linear-gradient(#ffe477, #fbcc5d);\r\n    /* IE7-9 */\r\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorStr=\'#ffe477\',EndColorStr=\'#fbcc5d\');\r\n  }\r\n  [role=\"complementary\"] #monthly-list a .archive-month {\r\n    border-radius: 0 0 5px 5px;\r\n  }\r\n  [role=\"complementary\"] #monthly-list a:hover .archive-month, [role=\"complementary\"] #monthly-list a:focus .archive-month {\r\n    background: #fdf5d9;\r\n  }\r\n  [role=\"complementary\"] #monthly-list span {\r\n    display: block;\r\n  }\r\n\r\n  [role=\"main\"] #article-list {\r\n    list-style: none;\r\n    margin: 0 0 2em 0;\r\n    border-top: 1px solid #f0f2f6;\r\n  }\r\n\r\n  #article-list li {\r\n    border-bottom: 1px solid #f0f2f6;\r\n    padding-top: 1em;\r\n  }\r\n\r\n  /* =============================================================================\r\n     Forms\r\n     ========================================================================== */\r\n\r\n  /* corrects margin displayed oddly in IE6-7 */\r\n  form {\r\n    margin: 0;\r\n  }\r\n\r\n  /* remove default fieldset styling across browsers */\r\n  fieldset {\r\n    margin: 0;\r\n    border: 0;\r\n    padding: 0;\r\n  }\r\n\r\n  /* hand cursor on clickable input elements (except disabled ones) */\r\n  label,\r\n  input[type=\"button\"],\r\n  input[type=\"submit\"],\r\n  input[type=\"reset\"],\r\n  button {\r\n    cursor: pointer;\r\n  }\r\n\r\n  input[disabled] {\r\n    cursor: default;\r\n  }\r\n\r\n  /* make Safari render search inputs as text inputs (and unstyled) */\r\n  input[type=\"search\"] {\r\n    -webkit-appearance: textfield;\r\n  }\r\n\r\n  ::-webkit-search-decoration {\r\n    display: none;\r\n  }\r\n\r\n  /* improves appearance and consistency in all browsers */\r\n  button,\r\n  .button,\r\n  input,\r\n  select,\r\n  textarea {\r\n    font-size: 100%;\r\n    margin: 0;\r\n    vertical-align: baseline;\r\n    /* improves appearance and consistency in IE7 */\r\n    *vertical-align: middle;\r\n  }\r\n\r\n  /* colour placeholder text (Webkit and Mozilla only, so far) */\r\n  ::-webkit-input-placeholder {\r\n    color: #bbb;\r\n  }\r\n\r\n  :-moz-placeholder {\r\n    color: #bbb;\r\n  }\r\n\r\n  /* suppress red glow that Firefox adds to form fields by default, even when user is still typing */\r\n  :invalid {\r\n    -webkit-box-shadow: none;\r\n    box-shadow: none;\r\n  }\r\n\r\n  input[type=\"text\"],\r\n  input[type=\"email\"],\r\n  input[type=\"url\"],\r\n  input[type=\"search\"],\r\n  textarea {\r\n    /* 11px / 13px */\r\n    font-size: .84615384615385em;\r\n    /* 15px / 11px */\r\n    line-height: 1.36363636363636em;\r\n    font-family: Verdana, \"Lucida Grande\", Tahoma, Arial, sans-serif;\r\n    border: solid 1px #d4d4d4;\r\n    padding: .5em 5px .55em;\r\n    background: #fff;\r\n    -webkit-box-sizing: border-box;\r\n    -moz-box-sizing: border-box;\r\n    box-sizing: border-box;\r\n  }\r\n  input[type=\"text\"]:hover, input[type=\"text\"]:focus,\r\n  input[type=\"email\"]:hover,\r\n  input[type=\"email\"]:focus,\r\n  input[type=\"url\"]:hover,\r\n  input[type=\"url\"]:focus,\r\n  input[type=\"search\"]:hover,\r\n  input[type=\"search\"]:focus,\r\n  textarea:hover,\r\n  textarea:focus {\r\n    background: #fdf5d9;\r\n  }\r\n\r\n  input[type=\"search\"] {\r\n    width: 192px;\r\n    margin-right: 2px;\r\n    padding: .5em 0 .55em 5px;\r\n    display: inline-block;\r\n    /* display and zoom IE7 fix for display:inline-block */\r\n    *display: inline;\r\n    *zoom: 1;\r\n  }\r\n\r\n  textarea {\r\n    width: 100%;\r\n    /* removes default vertical scrollbar in IE7-9 */\r\n    overflow: auto;\r\n    /* improves readability and alignment in all browsers */\r\n    vertical-align: top;\r\n    resize: vertical;\r\n  }\r\n\r\n  .large input {\r\n    width: 320px;\r\n  }\r\n  .large textarea {\r\n    height: 156px;\r\n  }\r\n\r\n  .small input {\r\n    width: 160px;\r\n  }\r\n  .small textarea {\r\n    height: 78px;\r\n  }\r\n\r\n  /* addresses box sizing set to content-box and excess padding in IE8-9 */\r\n  input[type=\"checkbox\"],\r\n  input[type=\"radio\"] {\r\n    box-sizing: border-box;\r\n    padding: 0;\r\n  }\r\n\r\n  .checkboxes,\r\n  .radiobuttons {\r\n    padding: 0 0 7px;\r\n  }\r\n  .checkboxes span,\r\n  .radiobuttons span {\r\n    display: block;\r\n  }\r\n  .checkboxes input,\r\n  .radiobuttons input {\r\n    float: left;\r\n    margin: 3px 8px 0 0;\r\n  }\r\n  .checkboxes label,\r\n  .radiobuttons label {\r\n    float: left;\r\n    display: block;\r\n  }\r\n\r\n  /* =============================================================================\r\n     Buttons\r\n     ========================================================================== */\r\n\r\n  /* make buttons play nice in IE: http://www.viget.com/inspire/styling-the-button-element-in-internet-explorer/ */\r\n  input,\r\n  button,\r\n  .button {\r\n    width: auto;\r\n    overflow: visible;\r\n  }\r\n\r\n  /* fix black border bug on styled buttons in IE7 by remove borders entirely */\r\n  .ie7 button,\r\n  .ie7 .button,\r\n  .ie7 input[type=\"button\"],\r\n  .ie7 input[type=\"reset\"],\r\n  .ie7 input[type=\"submit\"],\r\n  .ie7 #paginator span.disabled {\r\n    border: 0;\r\n  }\r\n\r\n  button,\r\n  .button,\r\n  input[type=\"button\"],\r\n  input[type=\"reset\"],\r\n  input[type=\"submit\"] {\r\n    /* 11px / 13px */\r\n    font-size: .84615384615385em;\r\n    /* 15px / 11px */\r\n    line-height: 1.36363636363636em;\r\n    font-family: Verdana, \"Lucida Grande\", Tahoma, Arial, sans-serif;\r\n    font-weight: normal;\r\n    text-align: center;\r\n    text-shadow: 1px 1px #ffe991;\r\n    outline: 0;\r\n    cursor: pointer;\r\n    border: solid 1px #e1a61a;\r\n    border-radius: 5px;\r\n    padding: .5em .8em .5em;\r\n    /* 28px */\r\n    height: 2.545454545454545em;\r\n    display: inline-block;\r\n    /* display and zoom IE7 fix for display:inline-block */\r\n    *display: inline;\r\n    *zoom: 1;\r\n    color: #333333;\r\n    background: #ffda44;\r\n    /* Safari4+, Chrome */\r\n    background: -webkit-gradient(linear, left top, left bottom, from(#ffda44), to(#fabc2b));\r\n    /* Safari5.1+, Chrome10+ */\r\n    background: -webkit-linear-gradient(#ffda44, #fabc2b);\r\n    /* Firefox3.6 */\r\n    background: -moz-linear-gradient(#ffda44, #fabc2b);\r\n    /* IE10 */\r\n    background: -ms-linear-gradient(#ffda44, #fabc2b);\r\n    /* Opera11.10+ */\r\n    background: -o-linear-gradient(#ffda44, #fabc2b);\r\n    /* CSS3 Compliant */\r\n    background: linear-gradient(#ffda44, #fabc2b);\r\n    /* IE7-9 */\r\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorStr=\'#ffda44\',EndColorStr=\'#fabc2b\');\r\n    -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\r\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\r\n  }\r\n  button:hover,\r\n  .button:hover,\r\n  input[type=\"button\"]:hover,\r\n  input[type=\"reset\"]:hover,\r\n  input[type=\"submit\"]:hover {\r\n    background: #ffe477;\r\n    /* Safari4+, Chrome */\r\n    background: -webkit-gradient(linear, left top, left bottom, from(#ffe477), to(#fbcc5d));\r\n    /* Safari5.1+, Chrome10+ */\r\n    background: -webkit-linear-gradient(#ffe477, #fbcc5d);\r\n    /* Firefox3.6 */\r\n    background: -moz-linear-gradient(#ffe477, #fbcc5d);\r\n    /* IE10 */\r\n    background: -ms-linear-gradient(#ffe477, #fbcc5d);\r\n    /* Opera11.10+ */\r\n    background: -o-linear-gradient(#ffe477, #fbcc5d);\r\n    /* CSS3 Compliant */\r\n    background: linear-gradient(#ffe477, #fbcc5d);\r\n    /* IE7-9 */\r\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorStr=\'#ffe477\',EndColorStr=\'#fbcc5d\');\r\n  }\r\n  button:active,\r\n  .button:active,\r\n  input[type=\"button\"]:active,\r\n  input[type=\"reset\"]:active,\r\n  input[type=\"submit\"]:active {\r\n    position: relative;\r\n    top: 1px;\r\n    color: #1a1a1a;\r\n    background: #fabc2b;\r\n    /* Safari4+, Chrome */\r\n    background: -webkit-gradient(linear, left top, left bottom, from(#fabc2b), to(#ffda44));\r\n    /* Safari5.1+, Chrome10+ */\r\n    background: -webkit-linear-gradient(#fabc2b, #ffda44);\r\n    /* Firefox3.6 */\r\n    background: -moz-linear-gradient(#fabc2b, #ffda44);\r\n    /* IE10 */\r\n    background: -ms-linear-gradient(#fabc2b, #ffda44);\r\n    /* Opera11.10+ */\r\n    background: -o-linear-gradient(#fabc2b, #ffda44);\r\n    /* CSS3 Compliant */\r\n    background: linear-gradient(#fabc2b, #ffda44);\r\n    /* IE7-9 */\r\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorStr=\'#fabc2b\',EndColorStr=\'#ffda44\');\r\n  }\r\n\r\n  input[type=\"submit\"].disabled,\r\n  #paginator span.disabled {\r\n    text-shadow: none;\r\n    top: 0;\r\n    cursor: default;\r\n    border: solid 1px #d2d2d2;\r\n    color: #999999;\r\n    background: #e6e6e6;\r\n    /* Safari4+, Chrome */\r\n    background: -webkit-gradient(linear, left top, left bottom, from(#e6e6e6), to(#dadada));\r\n    /* Safari5.1+, Chrome10+ */\r\n    background: -webkit-linear-gradient(#e6e6e6, #dadada);\r\n    /* Firefox3.6 */\r\n    background: -moz-linear-gradient(#e6e6e6, #dadada);\r\n    /* IE10 */\r\n    background: -ms-linear-gradient(#e6e6e6, #dadada);\r\n    /* Opera11.10+ */\r\n    background: -o-linear-gradient(#e6e6e6, #dadada);\r\n    /* CSS3 Compliant */\r\n    background: linear-gradient(#e6e6e6, #dadada);\r\n    /* IE7-9 */\r\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorStr=\'#e6e6e6\',EndColorStr=\'#dadada\');\r\n  }\r\n\r\n  #paginator {\r\n    margin: 1em 0;\r\n  }\r\n  #paginator .button {\r\n    padding: .1em .66em;\r\n    height: 1.5em;\r\n  }\r\n  #paginator a.button {\r\n    text-decoration: none;\r\n    color: #333333;\r\n  }\r\n\r\n  #paginator-l {\r\n    float: left;\r\n  }\r\n\r\n  #paginator-r {\r\n    float: right;\r\n  }\r\n\r\n  /* =============================================================================\r\n     Comments\r\n     ========================================================================== */\r\n\r\n  .comments {\r\n    margin-bottom: 20px;\r\n    border-radius: 5px;\r\n    padding: 1em 10px 0;\r\n    background: #f6f8fa;\r\n  }\r\n  .comments h4 span {\r\n    font-weight: normal;\r\n  }\r\n  .comments h4 .comment-anchor {\r\n    float: right;\r\n  }\r\n\r\n  .comments-author {\r\n    background: #f0f2f6;\r\n  }\r\n\r\n  #cpreview {\r\n    margin-bottom: 2px;\r\n    border-radius: 5px;\r\n    padding: 1em 10px;\r\n    background: #f0f2f6;\r\n  }\r\n\r\n  .comments_error {\r\n    background: #fff4f4 !important;\r\n  }\r\n\r\n  .required,\r\n  .error_message li {\r\n    color: #c00;\r\n  }\r\n\r\n  /* get rid of proprietary focus glows and add our own */\r\n  a:focus,\r\n  input:focus,\r\n  textarea:focus,\r\n  button:focus {\r\n    outline: 0;\r\n    background: #fdf5d9;\r\n    -webkit-box-shadow: 0 0 5px #fabc2b;\r\n    box-shadow: 0 0 5px #fabc2b;\r\n  }\r\n\r\n}\r\n\r\n\r\n/* =============================================================================\r\n   Additional layout for screen media < 960px\r\n   ========================================================================== */\r\n\r\n\r\n@media handheld and (max-width:480px),screen and (max-device-width:480px),screen and (max-width:960px) {\r\n\r\n  body {\r\n    width: 660px;\r\n  }\r\n\r\n  [role=\"main\"] {\r\n    float: none;\r\n  }\r\n\r\n  [role=\"complementary\"] {\r\n    float: none;\r\n    margin: 0 10px 20px;\r\n  }\r\n\r\n  footer {\r\n    width: 638px;\r\n  }\r\n\r\n}\r\n\r\n\r\n/* =============================================================================\r\n   Additional layout for screen media < 768px\r\n   ========================================================================== */\r\n\r\n\r\n@media only screen and (max-width: 767px) {\r\n\r\n  body {\r\n    width: 440px;\r\n  }\r\n\r\n  [role=\"main\"] {\r\n    width: 420px;\r\n  }\r\n\r\n  footer {\r\n    width: 418px;\r\n  }\r\n\r\n  blockquote {\r\n    margin-bottom: 1em;\r\n    width: 400px;\r\n  }\r\n\r\n  h1 {\r\n    /* 30px / 13px */\r\n    font-size: 2.30769230769231em;\r\n    /* 34px / 30px */\r\n    line-height: 1.13333333333333em;\r\n    padding-top: 0;\r\n  }\r\n\r\n  h2,\r\n  h3 {\r\n    /* 18px / 13px */\r\n    font-size: 1.38461538461538em;\r\n    /* 24px / 18px */\r\n    line-height: 1.33333333333333em;\r\n  }\r\n\r\n  .large input {\r\n    width: 280px;\r\n  }\r\n\r\n  .small input {\r\n    width: 140px;\r\n  }\r\n\r\n}\r\n\r\n\r\n/* =============================================================================\r\n   Additional layout for screen media < 480px\r\n   ========================================================================== */\r\n\r\n\r\n@media only screen and (max-width: 479px) {\r\n\r\n  body {\r\n    width: 300px;\r\n  }\r\n\r\n  [role=\"main\"] {\r\n    width: 280px;\r\n  }\r\n\r\n  footer {\r\n    width: 278px;\r\n  }\r\n\r\n  blockquote {\r\n    margin-bottom: 1em;\r\n    width: 260px;\r\n  }\r\n\r\n}\r\n\r\n\r\n/* =============================================================================\r\n   Styling and layout for print media\r\n   ========================================================================== */\r\n\r\n\r\n@media print {\r\n\r\n  * {\r\n    /* black prints faster: http://sanbeiji.com/archives/953 */\r\n    color: black !important;\r\n    text-shadow: none !important;\r\n    background: transparent !important;\r\n    filter: none !important;\r\n  }\r\n\r\n  @page {\r\n    margin: 0.5cm;\r\n}\r\n\r\n  body {\r\n    font-size: 8pt;\r\n    line-height: 12pt;\r\n    font-family: \"Helvetica Neue\", Helvetica, Arial, SunSans-Regular, sans-serif;\r\n    margin: 0;\r\n    padding: 2em 6em;\r\n  }\r\n\r\n  header {\r\n    margin-bottom: 24pt;\r\n    border-bottom: 1pt solid black;\r\n  }\r\n\r\n  footer {\r\n    margin-top: 12pt;\r\n    border-top: 1pt solid black;\r\n    padding-top: 12pt;\r\n  }\r\n\r\n  /* hide unnecessary content from print */\r\n  nav,\r\n  [role=\"complementary\"],\r\n  #paginator,\r\n  #comments-form,\r\n  .comments h4 a:last-child {\r\n    display: none;\r\n  }\r\n\r\n  a {\r\n    text-decoration: none;\r\n  }\r\n\r\n  /* show URLs for certain links in print */\r\n  a[href]:after {\r\n    content: \" (\" attr(href) \")\";\r\n  }\r\n\r\n  h1 a[href]:after,\r\n  h2 a[href]:after,\r\n  h3 a[href]:after,\r\n  sup a[href]:after,\r\n  .comment-count[href]:after,\r\n  a[rel=\"tag\"]:after {\r\n    content: \"\";\r\n  }\r\n\r\n  /* show long-form for abbreviations in print\r\n     acronym to be phased out of textile in favour of abbr */\r\n  abbr[title]:after,\r\n  acronym[title]:after {\r\n    content: \" (\" attr(title) \")\";\r\n  }\r\n\r\n  h1 {\r\n    font-size: 32pt;\r\n    line-height: 36pt;\r\n    font-weight: normal;\r\n    padding-bottom: 16pt;\r\n  }\r\n\r\n  h2,\r\n  h3 {\r\n    font-size: 14pt;\r\n    line-height: 18pt;\r\n    padding-bottom: 8pt;\r\n    page-break-after: avoid;\r\n    orphans: 3;\r\n    widows: 3;\r\n  }\r\n\r\n  p {\r\n    padding-bottom: 8pt;\r\n    orphans: 3;\r\n    widows: 3;\r\n  }\r\n\r\n  footer,\r\n  figcaption,\r\n  tfoot,\r\n  small,\r\n  .footnote {\r\n    font-size: 6pt;\r\n    line-height: 9pt;\r\n  }\r\n\r\n  blockquote {\r\n    margin-bottom: 8pt;\r\n    border: 1pt solid black;\r\n    padding: 8pt 8pt 0;\r\n    page-break-inside: avoid;\r\n  }\r\n\r\n  pre {\r\n    margin-bottom: 8pt;\r\n    border: 1pt solid black;\r\n    padding: 8pt;\r\n  }\r\n\r\n  .comments {\r\n    page-break-inside: avoid;\r\n  }\r\n\r\n  pre,\r\n  code,\r\n  kbd,\r\n  samp,\r\n  var {\r\n    font-family: \"Courier New\", Courier, monospace;\r\n  }\r\n\r\n  dfn,\r\n  q,\r\n  dt {\r\n    font-style: italic;\r\n  }\r\n\r\n  img {\r\n    max-width: 100% !important;\r\n    page-break-inside: avoid;\r\n  }\r\n\r\n  figure {\r\n    margin-bottom: 8pt;\r\n  }\r\n\r\n  figcaption {\r\n    margin-top: 4pt;\r\n  }\r\n\r\n  ul {\r\n    list-style: square;\r\n    margin: 0 0 8pt 1.8em;\r\n  }\r\n\r\n  ol {\r\n    list-style: decimal;\r\n    margin: 0 0 8pt 1.8em;\r\n  }\r\n\r\n  dl {\r\n    margin: 0 0 8pt 1.8em;\r\n  }\r\n\r\n  table {\r\n    margin-bottom: 8pt;\r\n    width: 100%;\r\n  }\r\n\r\n  caption {\r\n    font-weight: bold;\r\n    text-align: left;\r\n    margin-bottom: 4pt;\r\n  }\r\n\r\n  thead {\r\n    /* display table head across multi-page tables: http://css-discuss.incutio.com/wiki/Printing_Tables */\r\n    display: table-header-group;\r\n    border-right: 1pt solid black;\r\n    border-left: 1pt solid black;\r\n  }\r\n\r\n  tfoot {\r\n    border-right: 1pt solid black;\r\n    border-left: 1pt solid black;\r\n  }\r\n\r\n  tbody {\r\n    border-right: 1pt solid black;\r\n    border-left: 1pt solid black;\r\n  }\r\n\r\n  tr {\r\n    page-break-inside: avoid;\r\n  }\r\n\r\n  th,\r\n  td {\r\n    border-bottom: 1pt solid black;\r\n    padding: 4pt 8pt;\r\n  }\r\n\r\n  th {\r\n    text-align: left;\r\n    border-top: 1pt solid black;\r\n  }\r\n\r\n}\r\n')";

$create_sql[] = "CREATE TABLE `".PFX."txp_discuss` (
  `discussid` int(6) unsigned zerofill NOT NULL auto_increment,
  `parentid` int(8) NOT NULL default '0',
  `name` varchar(255) NOT NULL default '',
  `email` varchar(50) NOT NULL default '',
  `web` varchar(255) NOT NULL default '',
  `ip` varchar(100) NOT NULL default '',
  `posted` datetime NOT NULL default '0000-00-00 00:00:00',
  `message` text NOT NULL,
  `visible` tinyint(4) NOT NULL default '1',
  PRIMARY KEY  (`discussid`),
  KEY `parentid` (`parentid`)
) $tabletype PACK_KEYS=1 AUTO_INCREMENT=2 ";

$create_sql[] = "INSERT INTO `".PFX."txp_discuss` VALUES (000001, 1, 'Donald Swain', 'donald.swain@example.com', 'example.com', '127.0.0.1', '2005-07-22 14:11:32', '<p>I enjoy your site very much.</p>', 1)";

$create_sql[] = "CREATE TABLE `".PFX."txp_discuss_ipban` (
  `ip` varchar(255) NOT NULL default '',
  `name_used` varchar(255) NOT NULL default '',
  `date_banned` datetime NOT NULL default '0000-00-00 00:00:00',
  `banned_on_message` int(8) NOT NULL default '0',
  PRIMARY KEY (`ip`)
) $tabletype ";

$create_sql[] = "CREATE TABLE `".PFX."txp_discuss_nonce` (
  `issue_time` datetime NOT NULL default '0000-00-00 00:00:00',
  `nonce` varchar(255) NOT NULL default '',
  `used` tinyint(4) NOT NULL default '0',
  `secret` varchar(255) NOT NULL default '',
  PRIMARY KEY (`nonce`)
) $tabletype ";

$create_sql[] = "CREATE TABLE `".PFX."txp_file` (
  `id` int(11) NOT NULL auto_increment,
  `filename` varchar(255) NOT NULL default '',
  `category` varchar(255) NOT NULL default '',
  `permissions` varchar(32) NOT NULL default '0',
  `description` text NOT NULL,
  `downloads` int(4) unsigned NOT NULL default '0',
  PRIMARY KEY  (`id`),
  UNIQUE KEY `filename` (`filename`)
) $tabletype PACK_KEYS=0 AUTO_INCREMENT=1 ";

$create_sql[] = "CREATE TABLE `".PFX."txp_form` (
  `name` varchar(64) NOT NULL,
  `type` varchar(28) NOT NULL default '',
  `Form` text NOT NULL,
  PRIMARY KEY (`name`)
) $tabletype PACK_KEYS=1";

$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('Links', 'link', '<article>\r\n    <h4><txp:link /></h4>\r\n    <p><txp:link_description /><br>\r\n    <span class=\"footnote\">\r\n        <txp:text item=\"category\" />: <txp:link_category /> &#124; \r\n        <txp:text item=\"author\" />: <txp:link_author /> &#124; \r\n        <txp:text item=\"date_added\" />: <time datetime=\"<txp:link_date format=\'iso8601\' />\" pubdate><txp:link_date format=\"%d %B %Y\" /></time>\r\n    </span>\r\n    </p>\r\n</article>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('lofi', 'article', '<h3 class=\"entry-title\"><txp:title /> <txp:permlink>#</txp:permlink></h3>\n\n<p class=\"published\"><txp:posted /></p>\n\n<div class=\"entry-content\">\n<txp:body />\n</div>\n\n<hr />\n\n')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('single', 'article', '<h3 class=\"entry-title\"><txp:permlink><txp:title /></txp:permlink></h3>\n\t<p class=\"published\"><txp:posted /></p>\n\n<div class=\"entry-content\">\n<txp:body />\n</div>\n\n')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('plainlinks', 'link', '<!-- This is being used as an external links form, therefore rel is set to \'external\' -->\r\n<txp:linkdesctitle rel=\"external\" />')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('comments', 'comment', '<!-- load the comment email into a variable. you will be using below this along with author email variable loaded in form: default.article.txp\r\n    then check the comment email variable against article author email variable, and if it matches add \'comments-author\' class -->\r\n<txp:variable name=\"this_comment\" value=\'<txp:comment_email />\' />\r\n<txp:if_variable name=\"this_comment\" value=\'<txp:author_email />\'>\r\n    <article class=\"comments comments-author\">\r\n<txp:else />\r\n    <article class=\"comments\">\r\n</txp:if_variable>\r\n\r\n    <h4>\r\n\r\n    <txp:comment_name />\r\n\r\n    <!-- ...now check the comment email variable against article author email variable, and if it matches add \'(author)\' text -->\r\n    <txp:if_variable name=\"this_comment\" value=\'<txp:author_email />\'>\r\n        <span>(<txp:text item=\"author\" />)</span>\r\n    </txp:if_variable>\r\n\r\n    <!-- add a permlink so people can link direct to this comment -->\r\n    <txp:comment_permlink><span class=\"comment-anchor\">#</span></txp:comment_permlink>\r\n\r\n    </h4>\r\n\r\n    <!-- add time info for comment #TODO i18n # - also adding a \'since\' to show comment freshness -->\r\n    <p class=\"footnote\"><time datetime=\"<txp:comment_time format=\'iso8601\' />\"><txp:comment_time format=\"%d/%m/%y\" /> <txp:comment_time format=\"%H:%M\" /> (<txp:comment_time format=\"since\" />)</time></p>\r\n\r\n    <txp:comment_message />\r\n\r\n</article>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('default', 'article', '<article role=\"article\">\r\n\r\n<!-- if not an individual article then make the title h1 a link -->\r\n<txp:if_individual_article>\r\n    <h1><txp:title /></h1>\r\n<txp:else />\r\n    <h1><txp:permlink><txp:title /></txp:permlink></h1>\r\n</txp:if_individual_article>\r\n\r\n<!-- using HTML5 \'time\' tag -->\r\n    <p><strong><txp:text item=\"posted\" />:</strong> <time datetime=\"<txp:posted format=\'iso8601\' />\" pubdate><txp:posted /></time></p>\r\n<!-- see http://php.net/manual/en/function.strftime.php for reference list of time/date strings -->\r\n\r\n    <p><strong> <txp:text item=\"comments\" />:</strong> <a class=\"comment-count\" href=\"<txp:permlink />#comments-head\" title=\"<txp:text item=\'view\' />&#8230;\">\r\n\r\n<!-- if comments then display the number, if no comments then print \'none\' -->\r\n<txp:if_comments>\r\n    <txp:comments_count />\r\n<txp:else />\r\n    <txp:text item=\"none\" />\r\n</txp:if_comments>\r\n\r\n    </a></p>\r\n\r\n    <txp:body />\r\n\r\n    <p><strong><txp:text item=\"author\" />:</strong> <txp:author /></p>\r\n\r\n<!-- only display categories if they are actually set for an article, otherwise omit -->\r\n    <txp:if_article_category>\r\n        <p><strong><txp:text item=\"categories\" />:</strong> <txp:category1 title=\"1\" link=\"1\" /><txp:if_article_category number=\"2\">, <txp:category2 title=\"1\" link=\"1\" /></txp:if_article_category></p>\r\n    </txp:if_article_category>\r\n\r\n<!-- if this is an individual article then add the comments section via form: comments_display.article.txp -->\r\n<txp:if_individual_article>\r\n    <txp:article form=\"comments_display\" />\r\n</txp:if_individual_article>\r\n\r\n</article>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('comment_form', 'comment', '<p><txp:text item=\"enter_comment_here\" /></p>\r\n\r\n<!-- if there is an error, then inform user -->\r\n<txp:if_comments_error>\r\n    <txp:comments_error wraptag=\"ol\" break=\"li\" class=\"error_message\" />\r\n</txp:if_comments_error>\r\n\r\n<fieldset>\r\n\r\n    <p class=\"large\"><label for=\"name\"><txp:text item=\"comment_name\" /> <b class=\"required\">*</b></label><br>\r\n    <txp:comment_name_input /></p>\r\n\r\n    <p class=\"large\"><label for=\"email\"><txp:text item=\"comment_email\" /> <b class=\"required\">*</b></label><br>\r\n    <txp:comment_email_input /></p> <!-- Textpattern currently does not currently use HTML5 input type=\"email\" -->\r\n\r\n    <p class=\"large\"><label for=\"web\"><txp:text item=\"comment_web\" /></label><br>\r\n    <txp:comment_web_input /></p> <!-- Textpattern currently does not currently use HTML5 input type=\"url\" -->\r\n\r\n    <p class=\"checkboxes\"><span class=\"clearfix\"><txp:comment_remember /></span></p>\r\n\r\n    <p class=\"small\"><label for=\"message\"><txp:text item=\"comment_message\" /> <b class=\"required\">*</b></label><br>\r\n    <txp:comment_message_input /></p>\r\n\r\n</fieldset>\r\n\r\n<!-- preview and submit buttons (note: submit button will have a class of \'disabled\' applied until you have previewed the message at least once) -->\r\n<p><txp:comment_preview /> <txp:comment_submit /></p>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('noted', 'link', '<p><txp:link />. <txp:link_description /></p>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('popup_comments', 'comment', '<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\">\n<head>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n\t<title><txp:page_title /></title>\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"<txp:css />\" />\n</head>\n<body>\n\n<div style=\"padding: 1em; width:300px;\">\n<txp:popup_comments />\n</div>\n\n</body>\n</html>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('files', 'file', '<!-- set up a variable to check whether a file also has a description associated with it... -->\r\n<txp:variable name=\"file_download_description\" value=\"<txp:file_download_description />\" />\r\n\r\n<strong><a href=\"<txp:file_download_link />\" title=\"<txp:file_download_name title=\'1\' />\"><txp:file_download_name title=\"1\" /></a></strong><br>\r\n\r\n<!-- ...now use that description, otherwise omit that line -->\r\n<txp:if_variable name=\"file_download_description\" value=\"\">\r\n\r\n<txp:else />\r\n\r\n<txp:file_download_description /><br>\r\n\r\n<txp:if_variable>\r\n\r\n<span class=\"footnote\">\r\n    <txp:text item=\"category\" />: <txp:file_download_category /> &#124; \r\n    <txp:text item=\"file_size\" />: <txp:file_download_size /> &#124; \r\n    <txp:text item=\"last_modified\" />: <txp:file_download_created format=\"%d %B %Y\" /> &#124; \r\n    <txp:text item=\"download_count\" />: <txp:file_download_downloads />\r\n</span>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('search_results', 'article', '<txp:if_search>\r\n\r\n<!-- count how many results return -->\r\n    <txp:article limit=\"10\" pgonly=\"1\" />\r\n\r\n    <txp:if_search_results>\r\n\r\n<!-- if search result count greater than 200 then display excessive results message, otherwise show search result count -->\r\n        <txp:if_search_results max=\"200\">\r\n            <h3><txp:search_result_count /> <txp:text item=\"matching_search_request\" /> &#8216;<txp:search_term />&#8217;&#8230;</h3>\r\n        <txp:else />\r\n            <h3><txp:text item=\"too_common_search_term\" /> &#8216;<txp:search_term />&#8217;</h3>\r\n        </txp:if_search_results>\r\n\r\n<!-- if no search results, then display no search results message -->\r\n    <txp:else />\r\n        <h3><txp:text item=\"no_search_matches\" /> &#8216;<txp:search_term />&#8217;</h3>\r\n\r\n    </txp:if_search_results>\r\n\r\n<!-- display resulting articles (10 per page) -->\r\n    <txp:article limit=\"10\">\r\n\r\n        <article>\r\n\r\n            <h1><txp:permlink><txp:title /></txp:permlink></h1>\r\n\r\n<!-- see default.article.txp for info on HTML5 \'time\' tag -->\r\n            <p><strong><txp:text item=\"posted\" />:</strong> <time datetime=\"<txp:posted format=\'iso8601\' />\" pubdate><txp:posted /></time></p>\r\n\r\n<!-- if the article has an excerpt, display that, otherwise show highlighted keywords in context of article -->\r\n            <txp:if_excerpt>\r\n                <txp:excerpt />\r\n            <txp:else />\r\n                <p><txp:search_result_excerpt /></p>\r\n            </txp:if_excerpt>\r\n\r\n<!-- display the URL of the article as text (and link) -->\r\n            <p class=\"footnote\"><txp:permlink><txp:permlink /></txp:permlink></p>\r\n\r\n        </article>\r\n\r\n    </txp:article>\r\n\r\n<!-- check if there are further results and provide pagination links or disabled buttons depending on the result,\r\n    this method is more flexibile than using simple txp:older/txp:newer tags -->\r\n    <txp:if_search_results min=\"11\">\r\n\r\n        <p id=\"paginator\" class=\"clearfix\">\r\n\r\n        <txp:variable name=\"prev\" value=\'<txp:older />\' />\r\n        <txp:variable name=\"next\" value=\'<txp:newer />\' />\r\n\r\n        <txp:if_variable name=\"next\" value=\"\">\r\n            <span id=\"paginator-l\" class=\"button disabled\">&#171; <txp:text item=\"prev\" /></span>\r\n        <txp:else />\r\n                <a id=\"paginator-l\" href=\"<txp:newer />\" title=\"&#171; <txp:text item=\"prev\" />\" class=\"button\">&#171; <txp:text item=\"prev\" /></a>\r\n        </txp:if_variable>\r\n        <txp:if_variable name=\"prev\" value=\"\">\r\n            <span id=\"paginator-r\" class=\"button disabled\"><txp:text item=\"next\" /> &#187;</span>\r\n        <txp:else />\r\n            <a id=\"paginator-r\" href=\"<txp:older />\" title=\"<txp:text item=\"next\" /> &#187;\" class=\"button\"><txp:text item=\"next\" /> &#187;</a>\r\n        </txp:if_variable>\r\n\r\n        </p>\r\n\r\n    </txp:if_search_results>\r\n\r\n</txp:if_search>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('comments_display', 'article', '<!-- added an id attribute to the section so we can link directly to here e.g. http://mysite.com/section/article#comments-head -->\r\n\r\n<section id=\"comments-head\">\r\n\r\n<h3><txp:text item=\"comments\" /></h3>\r\n\r\n<!-- if there are comments, display them (note: example code below overrides the global preference setting for comments wrapping by stating\r\n    attributes of wraptag=\"\" and break=\"\", you are instead using ol and li tags below)... -->\r\n<txp:if_comments>\r\n    <ol class=\"comments-list\">\r\n\r\n        <txp:comments wraptag=\"\" break=\"li\" /> <!-- links by default to form: \'comments.comment.txp\' unless you specify a different form -->\r\n\r\n    <!-- if this is a comment preview, display it (but only if there is no error) -->\r\n        <txp:if_comments_preview>\r\n            <li>\r\n                <p id=\"cpreview\"><txp:text item=\"press_preview_then_submit\" /></p>\r\n                <txp:comments_preview wraptag=\"\" /> <!-- links by default to form: \'comments.comment.txp\' unless you specify a different form -->\r\n            </li>\r\n        </txp:if_comments_preview>\r\n\r\n    </ol>\r\n\r\n<txp:else />\r\n\r\n<!-- else if there are no comments and if user is currently previewing comment,display it (but only if there is no error) -->\r\n    <txp:if_comments_preview>\r\n        <ol class=\"comments-list\">\r\n            <li>\r\n                <p id=\"cpreview\"><txp:text item=\"press_preview_then_submit\" /></p>\r\n                <txp:comments_preview wraptag=\"\" /> <!-- links by default to form: \'comments.comment.txp\' unless you specify a different form -->\r\n            </li>\r\n        </ol>\r\n\r\n    <txp:else />\r\n\r\n<!-- else just display that there are simply no comments whatsoever :( ...but only if comments are allowed -->\r\n        <txp:if_comments_allowed>\r\n            <p><txp:text item=\"no_comments\" /></p>\r\n        </txp:if_comments_allowed>\r\n\r\n    </txp:if_comments_preview>\r\n\r\n</txp:if_comments>\r\n\r\n<!-- if new comments are allowed for this article then display comment form, if not then display \'closed\' messages -->\r\n<txp:if_comments_allowed>\r\n    <section id=\"comments-form\">\r\n\r\n        <!-- comment invite text is taken for the article\'s comment invitation field on the \'write\' screen -->\r\n        <h3><txp:comments_invite showcount=\"0\" textonly=\"1\" showalways=\"1\" /></h3>\r\n\r\n        <txp:comments_form isize=\"32\" msgcols=\"64\" msgrows=\"4\" /> <!-- links by default to form: \'comment_form.comment.txp\' unless you specify a different form -->\r\n    </section>\r\n\r\n<txp:else />\r\n    \r\n    <!-- display either a comments expired message or a comments disabled message -->\r\n    <txp:if_comments>\r\n        <p><strong><txp:text item=\"comments_expired\" /></strong></p>\r\n    <txp:else />\r\n        <p><strong><txp:text item=\"comments_closed\" /></strong></p>\r\n    </txp:if_comments>\r\n</txp:if_comments_allowed>\r\n\r\n</section>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('article_listing', 'article', '<!-- see default.article.txp for info on HTML5 \'time\' tag -->\r\n<txp:if_first_article><ul id=\"article-list\"></txp:if_first_article>\r\n    <li>\r\n        <h4><txp:permlink><txp:title /></txp:permlink></h4>\r\n        <p class=\"footnote\"><txp:text item=\"posted\" />: <time datetime=\"<txp:posted format=\'iso8601\' />\" pubdate><txp:posted /></time>, <txp:text item=\"author\" />: <txp:author /></p>\r\n    </li>\r\n<txp:if_last_article></ul></txp:if_last_article>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('search_input', 'misc', '<form role=\"search\" method=\"get\" action=\"<txp:site_url />\">\r\n    <h4><label for=\"search-textbox\"><txp:text item=\"search\" /></label></h4>\r\n    <p><input id=\"search-textbox\" type=\"search\" name=\"q\" placeholder=\"<txp:text item=\'search\' /> <txp:site_name />\" /><input type=\"submit\" value=\"<txp:text item=\'go\' />\" /></p>\r\n</form>')";
$create_sql[] = "INSERT INTO `".PFX."txp_form` VALUES ('images', 'misc', '<!-- set up a variable to check whether a image also has a caption associated with it... -->\r\n<txp:variable name=\"caption\" value=\'<txp:image_info type=\"caption\" />\' />\r\n\r\n<!-- ...now use that image caption and wrap img inside a figure with figcaption tags, otherwise just use a plain img tag -->\r\n<txp:if_variable name=\"caption\" value=\"\">\r\n\r\n<!-- image - overriding the width and height to let the image scale to fit parent container -->\r\n    <p><txp:image width=\"0\" height=\"0\" /></p>\r\n\r\n<txp:else />\r\n\r\n    <figure>\r\n\r\n<!-- image - overriding the width and height to let the image scale to fit parent container -->\r\n        <txp:image width=\"0\" height=\"0\" />\r\n\r\n<!-- you do not need to specify the attribute type=\"caption\" as that is the default setting for <txp:image_info /> tag -->\r\n        <figcaption><txp:image_info type=\"caption\" /></figcaption>\r\n\r\n    </figure>\r\n\r\n</txp:if_variable>')";

$create_sql[] = "CREATE TABLE `".PFX."txp_image` (
  `id` int(11) NOT NULL auto_increment,
  `name` varchar(255) NOT NULL default '',
  `category` varchar(255) NOT NULL default '',
  `ext` varchar(20) NOT NULL default '',
  `w` int(8) NOT NULL default '0',
  `h` int(8) NOT NULL default '0',
  `alt` varchar(255) NOT NULL default '',
  `caption` text NOT NULL,
  `date` datetime NOT NULL default '0000-00-00 00:00:00',
  `author` varchar(255) NOT NULL default '',
  `thumbnail` int(2) NOT NULL default '0',
  PRIMARY KEY  (`id`)
) $tabletype PACK_KEYS=0 AUTO_INCREMENT=2 ";

$create_sql[] = "INSERT INTO `".PFX."txp_image` VALUES (1, 'divider.gif', 'site-design', '.gif', 400, 1, '---', '', '2005-07-22 16:37:11', '".doSlash($name)."', 0)";
$create_sql[] = "INSERT INTO `".PFX."txp_image` VALUES (2, 'txp_slug105x45.gif', 'site-design', '.gif', 105, 45, 'Textpattern CMS', '', '1977-12-24 13:20:42', '".doSlash($name)."', 0)";

$create_sql[] = "CREATE TABLE `".PFX."txp_lang` (
  `id` int(9) NOT NULL auto_increment,
  `lang` varchar(16) NOT NULL,
  `name` varchar(64) NOT NULL,
  `event` varchar(64) NOT NULL,
  `data` tinytext,
  `lastmod` timestamp,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `lang` (`lang`,`name`),
  KEY `lang_2` (`lang`,`event`)
) $tabletype AUTO_INCREMENT=1 ";

$create_sql[] = "CREATE TABLE `".PFX."txp_link` (
  `id` int(6) NOT NULL auto_increment,
  `date` datetime NOT NULL default '0000-00-00 00:00:00',
  `category` varchar(64) NOT NULL default '',
  `url` text NOT NULL,
  `linkname` varchar(255) NOT NULL default '',
  `linksort` varchar(128) NOT NULL default '',
  `description` text NOT NULL,
  PRIMARY KEY  (`id`)
) $tabletype PACK_KEYS=1 AUTO_INCREMENT=4 ";

$create_sql[] = "INSERT INTO `".PFX."txp_link` VALUES (1, '2005-07-20 12:54:26', 'textpattern', 'http://textpattern.com/', 'Textpattern', 'Textpattern', '')";
$create_sql[] = "INSERT INTO `".PFX."txp_link` VALUES (2, '2005-07-20 12:54:41', 'textpattern', 'http://textpattern.net/', 'User Documentation', 'User Documentation', '')";
$create_sql[] = "INSERT INTO `".PFX."txp_link` VALUES (3, '2005-07-20 12:55:04', 'textpattern', 'http://textpattern.org/', 'Txp Resources', 'Txp Resources', '')";

$create_sql[] = "CREATE TABLE `".PFX."txp_log` (
  `id` int(12) NOT NULL auto_increment,
  `time` datetime NOT NULL default '0000-00-00 00:00:00',
  `host` varchar(255) NOT NULL default '',
  `page` varchar(255) NOT NULL default '',
  `refer` mediumtext NOT NULL,
  `status` int(11) NOT NULL default '200',
  `method` varchar(16) NOT NULL default 'GET',
  `ip` varchar(16) NOT NULL default '',
  PRIMARY KEY  (`id`),
  KEY `time` (`time`)
) $tabletype AUTO_INCREMENT=77 ";

$create_sql[] = "CREATE TABLE `".PFX."txp_page` (
  `name` varchar(128) NOT NULL,
  `user_html` text NOT NULL,
  PRIMARY KEY (`name`)
) $tabletype PACK_KEYS=1";

$create_sql[] = "INSERT INTO `".PFX."txp_page` VALUES ('default', '<!doctype html>\r\n<!--[if lt IE 8]><html class=\"no-js ie7\" lang=\"<txp:lang />\"><![endif]-->\r\n<!--[if IE 8]>   <html class=\"no-js ie8\" lang=\"<txp:lang />\"><![endif]-->\r\n<!--[if gt IE 8]><!--><html class=\"no-js\" lang=\"<txp:lang />\"><!--<![endif]-->\r\n\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n\r\n<!-- page title and metas, no meta keywords as they are now obsolete -->\r\n    <title><txp:page_title /></title>\r\n    <meta name=\"description\" content=\"\">\r\n\r\n<!-- mobile viewport optimized: j.mp/bplateviewport -->\r\n    <meta name=\"viewport\" content=\"width=device-width,target-densitydpi=160dpi,initial-scale=1\">\r\n\r\n<!-- place favicon.ico and apple-touch-icon.png in the root of your domain and delete these references: mathiasbynens.be/notes/touch-icons -->\r\n    <link rel=\"shortcut icon\" href=\"<txp:site_url />favicon.ico\">\r\n    <link rel=\"apple-touch-icon\" href=\"<txp:site_url />apple-touch-icon.png\">\r\n\r\n<!-- content feeds -->\r\n    <txp:feed_link flavor=\"atom\" format=\"link\" label=\"Atom\" />\r\n    <txp:feed_link flavor=\"rss\" format=\"link\" label=\"RSS\" />\r\n    <txp:rsd />\r\n\r\n<!-- specify canonical, more info: http://googlewebmastercentral.blogspot.com/2009/02/specify-your-canonical.html -->\r\n    <txp:if_section name=\"\">\r\n        <link rel=\"canonical\" href=\"<txp:site_url />\">\r\n    <txp:else />\r\n        <txp:if_individual_article>\r\n            <link rel=\"canonical\" href=\"<txp:permlink />\">\r\n        <txp:else />\r\n            <link rel=\"canonical\" href=\"<txp:section url=\"1\" />\">\r\n        </txp:if_individual_article>\r\n    </txp:if_section>\r\n\r\n<!-- css -->\r\n    <!-- Google font API -->\r\n    <link rel=\"stylesheet\" href=\"http://fonts.googleapis.com/css?family=Droid+Serif:n4,i4,n7,i7|Cousine\">\r\n\r\n    <txp:css format=\"link\" />\r\n    <!-- or you can use external CSS files eg. <link rel=\"stylesheet\" href=\"<txp:site_url />css/default.css\"> -->\r\n\r\n<!-- all JavaScript should go at the bottom, except for Modernizr which enables HTML5 elements & feature detects.\r\n    you should replace this with your own build containing only the tests you actually need via: www.modernizr.com/download/ -->\r\n    <script src=\"<txp:site_url />js/modernizr.js\"></script>\r\n\r\n</head>\r\n\r\n<body id=\"<txp:if_section name=\"\"><txp:if_search>search<txp:else />front</txp:if_search><txp:else /><txp:section /></txp:if_section>-page\">\r\n\r\n<!-- header -->\r\n    <header role=\"banner\">\r\n        <hgroup>\r\n            <h1><txp:link_to_home><txp:site_name /></txp:link_to_home></h1>\r\n            <h2><txp:site_slogan /></h2>\r\n        </hgroup>\r\n    </header>\r\n\r\n<!-- navigation -->\r\n    <nav role=\"navigation\" class=\"clearfix\">\r\n        <h1><txp:text item=\"navigation\" /></h1>\r\n        <txp:section_list default_title=\'<txp:text item=\"home\" />\' include_default=\"1\" wraptag=\"ul\" break=\"li\">\r\n            <txp:section link=\"1\" title=\"1\" />\r\n        </txp:section_list>\r\n    </nav>\r\n\r\n<!-- left (main) column -->\r\n    <div role=\"main\">\r\n\r\n    <!-- is this result result page? also omits the pagination links below (uses pagination format within search_results.article.txp instead) -->\r\n    <txp:if_search>\r\n\r\n        <h1><txp:text item=\"search_results\" /></h1>\r\n        <txp:output_form form=\"search_results\"/>\r\n\r\n    <txp:else />\r\n\r\n        <!-- else is this an article category list? -->\r\n        <txp:if_category>\r\n\r\n            <h1><txp:text item=\"category\" />: <txp:category title=\"1\" /></h1>\r\n            <txp:article form=\"article_listing\" limit=\"5\" />\r\n\r\n        <!-- else display articles normally -->\r\n        <txp:else />\r\n\r\n            <txp:article limit=\"5\" /> <!-- links by default to form: \'default.article.txp\' unless you specify a different form -->\r\n\r\n        </txp:if_category>\r\n    \r\n        <!-- add pagination links to foot of article/article listings/category listings if there are more articles available,\r\n            this method is more flexibile than using simple txp:link_to_prev/txp:link_to_next or txp:older/txp:newer tags -->\r\n        <p id=\"paginator\" class=\"clearfix\">\r\n\r\n        <txp:variable name=\"prev\" value=\'<txp:older />\' />\r\n        <txp:variable name=\"next\" value=\'<txp:newer />\' />\r\n\r\n        <txp:if_variable name=\"prev\" value=\"\">\r\n            <span id=\"paginator-l\" class=\"button disabled\">&#171; <txp:text item=\"older\" /></span>\r\n        <txp:else />\r\n            <a id=\"paginator-l\" href=\"<txp:older />\" title=\"<txp:text item=\'older\' />\" class=\"button\">&#171; <txp:text item=\"older\" /></a>\r\n        </txp:if_variable>\r\n        <txp:if_variable name=\"next\" value=\"\">\r\n            <span id=\"paginator-r\" class=\"button disabled\"><txp:text item=\"newer\" /> &#187;</span>\r\n        <txp:else />\r\n                <a id=\"paginator-r\" href=\"<txp:newer />\" title=\"<txp:text item=\'newer\' />\" class=\"button\"><txp:text item=\"newer\" /> &#187;</a>\r\n        </txp:if_variable>\r\n\r\n        </p>\r\n\r\n    </txp:if_search>\r\n\r\n    </div>\r\n\r\n<!-- right (complementary) column -->\r\n    <div role=\"complementary\">\r\n        <txp:search_input /> <!-- links by default to form: \'search_input.misc.txp\' unless you specify a different form -->\r\n\r\n        <!-- Feed links, default flavor is rss, so we don\'t need to specify a flavor on the first feed_link -->\r\n        <p><txp:feed_link label=\"RSS\" class=\"feed-rss\" /> / <txp:feed_link flavor=\"atom\" label=\"Atom\" class=\"feed-atom\" /></p>\r\n\r\n        <h4><txp:text item=\"recent_articles\" /></h4>\r\n        <ul id=\"monthly-list\" class=\"clearfix\">\r\n            <!-- using if_different tag to populate list only with months that actually contain articles -->\r\n            <txp:article_custom section=\"articles\" limit=\"12\">\r\n                <txp:if_different>\r\n                    <li><a href=\"<txp:site_url />articles/?month=<txp:posted format=\"%Y-%m\"/>\"><span class=\"archive-year\"><txp:posted format=\"%Y\" /></span> <span class=\"archive-month\"><txp:posted format=\"%b\"/></span></a></li>\r\n                </txp:if_different>\r\n            </txp:article_custom>\r\n        </ul>\r\n\r\n        <h4><txp:text item=\"external_links\" /></h4>\r\n        <txp:linklist wraptag=\"ul\" break=\"li\" limit=\"10\" /> <!-- links by default to form: \'plainlinks.link.txp\' unless you specify a different form -->\r\n    </div>\r\n\r\n<!-- footer -->\r\n    <footer role=\"contentinfo\">\r\n        <!-- using PHP to dynamically update the copyright year -->\r\n        <small>&#169;<txp:php>echo date(\'Y\');</txp:php> <txp:site_name />. <txp:text item=\"published_with\" /> <a href=\"http://textpattern.com\" rel=\"external\">Textpattern CMS</a>.</small>\r\n    </footer>\r\n\r\n<!-- JavaScript at the bottom for fast page loading -->\r\n\r\n    <!-- add your own JavaScript here -->\r\n\r\n</body>\r\n</html>')";
$create_sql[] = "INSERT INTO `".PFX."txp_page` VALUES ('archive', '<!doctype html>\r\n<!--[if lt IE 8]><html class=\"no-js ie7\" lang=\"<txp:lang />\"><![endif]-->\r\n<!--[if IE 8]>   <html class=\"no-js ie8\" lang=\"<txp:lang />\"><![endif]-->\r\n<!--[if gt IE 8]><!--><html class=\"no-js\" lang=\"<txp:lang />\"><!--<![endif]-->\r\n\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n\r\n<!-- page title and metas, no meta keywords as they are now obsolete -->\r\n    <title><txp:page_title /></title>\r\n    <meta name=\"description\" content=\"\">\r\n\r\n<!-- mobile viewport optimized: j.mp/bplateviewport -->\r\n    <meta name=\"viewport\" content=\"width=device-width,target-densitydpi=160dpi,initial-scale=1\">\r\n\r\n<!-- place favicon.ico and apple-touch-icon.png in the root of your domain and delete these references: mathiasbynens.be/notes/touch-icons -->\r\n    <link rel=\"shortcut icon\" href=\"<txp:site_url />favicon.ico\">\r\n    <link rel=\"apple-touch-icon\" href=\"<txp:site_url />apple-touch-icon.png\">\r\n\r\n<!-- content feeds -->\r\n    <txp:feed_link flavor=\"atom\" format=\"link\" label=\"Atom\" />\r\n    <txp:feed_link flavor=\"rss\" format=\"link\" label=\"RSS\" />\r\n    <txp:rsd />\r\n\r\n<!-- specify canonical, more info: http://googlewebmastercentral.blogspot.com/2009/02/specify-your-canonical.html -->\r\n    <txp:if_individual_article>\r\n        <link rel=\"canonical\" href=\"<txp:permlink />\">\r\n    <txp:else />\r\n        <link rel=\"canonical\" href=\"<txp:section url=\"1\" />\">\r\n    </txp:if_individual_article>\r\n\r\n<!-- css -->\r\n    <!-- Google font API -->\r\n    <link rel=\"stylesheet\" href=\"http://fonts.googleapis.com/css?family=Droid+Serif:n4,i4,n7,i7|Cousine\">\r\n\r\n    <txp:css format=\"link\" />\r\n    <!-- or you can use external CSS files eg. <link rel=\"stylesheet\" href=\"<txp:site_url />css/default.css\"> -->\r\n\r\n<!-- all JavaScript should go at the bottom, except for Modernizr which enables HTML5 elements & feature detects.\r\n    you should replace this with your own build containing only the tests you actually need via: www.modernizr.com/download/ -->\r\n    <script src=\"<txp:site_url />js/modernizr.js\"></script>\r\n\r\n</head>\r\n\r\n<body id=\"<txp:section />-page\">\r\n\r\n<!-- header -->\r\n    <header role=\"banner\">\r\n        <hgroup>\r\n            <h1><txp:link_to_home><txp:site_name /></txp:link_to_home></h1>\r\n            <h2><txp:site_slogan /></h2>\r\n        </hgroup>\r\n    </header>\r\n\r\n<!-- navigation -->\r\n    <nav role=\"navigation\" class=\"clearfix\">\r\n        <h1><txp:text item=\"navigation\" /></h1>\r\n        <txp:section_list default_title=\'<txp:text item=\"home\" />\' include_default=\"1\" wraptag=\"ul\" break=\"li\">\r\n            <txp:section link=\"1\" title=\"1\" />\r\n        </txp:section_list>\r\n    </nav>\r\n\r\n<!-- left (main) column -->\r\n    <div role=\"main\">\r\n\r\n        <txp:if_article_list><h1><txp:section title=\"1\" /></h1></txp:if_article_list>\r\n\r\n        <txp:article listform=\"article_listing\" limit=\"5\" />\r\n\r\n        <!-- add pagination links to foot of article/article listings if there are more articles available,\r\n            this method is more flexibile than using simple txp:link_to_prev/txp:link_to_next or txp:older/txp:newer tags -->\r\n        <p id=\"paginator\" class=\"clearfix\">\r\n\r\n        <txp:if_individual_article>\r\n\r\n            <txp:variable name=\"prev\" value=\'<txp:link_to_prev />\' />\r\n            <txp:variable name=\"next\" value=\'<txp:link_to_next />\' />\r\n\r\n            <txp:if_variable name=\"prev\" value=\"\">\r\n                <span id=\"paginator-l\" class=\"button disabled\">&#171; <txp:text item=\"older\" /></span>\r\n            <txp:else />\r\n                <a id=\"paginator-l\" href=\"<txp:link_to_prev />\" title=\"<txp:prev_title />\" class=\"button\">&#171; <txp:text item=\"older\" /></a>\r\n            </txp:if_variable>\r\n            <txp:if_variable name=\"next\" value=\"\">\r\n                <span id=\"paginator-r\" class=\"button disabled\"><txp:text item=\"newer\" /> &#187;</span>\r\n            <txp:else />\r\n                <a id=\"paginator-r\" href=\"<txp:link_to_next />\" title=\"<txp:next_title />\" class=\"button\"><txp:text item=\"newer\" /> &#187;</a>\r\n            </txp:if_variable>\r\n\r\n        <txp:else />\r\n\r\n            <txp:variable name=\"prev\" value=\'<txp:older />\' />\r\n            <txp:variable name=\"next\" value=\'<txp:newer />\' />\r\n            <txp:if_variable name=\"prev\" value=\"\">\r\n                <span id=\"paginator-l\" class=\"button disabled\">&#171; <txp:text item=\"older\" /></span>\r\n            <txp:else />\r\n                <a id=\"paginator-l\" href=\"<txp:older />\" title=\"<txp:text item=\'older\' />\" class=\"button\">&#171; <txp:text item=\"older\" /></a>\r\n            </txp:if_variable>\r\n            <txp:if_variable name=\"next\" value=\"\">\r\n                <span id=\"paginator-r\" class=\"button disabled\"><txp:text item=\"newer\" /> &#187;</span>\r\n            <txp:else />\r\n                <a id=\"paginator-r\" href=\"<txp:newer />\" title=\"<txp:text item=\'newer\' />\" class=\"button\"><txp:text item=\"newer\" /> &#187;</a>\r\n            </txp:if_variable>\r\n\r\n        </txp:if_individual_article>\r\n\r\n        </p>\r\n\r\n    </div>\r\n\r\n<!-- right (complementary) column -->\r\n    <div role=\"complementary\">\r\n        <txp:search_input /> <!-- links by default to form: \'search_input.misc.txp\' unless you specify a different form -->\r\n\r\n        <!-- Feed links, default flavor is rss, so we don\'t need to specify a flavor on the first feed_link -->\r\n        <p><txp:feed_link label=\"RSS\" class=\"feed-rss\" /> / <txp:feed_link flavor=\"atom\" label=\"Atom\" class=\"feed-atom\" /></p>\r\n\r\n        <h4><txp:text item=\"recent_articles\" /></h4>\r\n        <ul id=\"monthly-list\" class=\"clearfix\">\r\n            <!-- using if_different tag to populate list only with months that actually contain articles -->\r\n            <txp:article_custom section=\"articles\" limit=\"12\">\r\n                <txp:if_different>\r\n                    <li><a href=\"<txp:site_url />articles/?month=<txp:posted format=\"%Y-%m\"/>\"><span class=\"archive-year\"><txp:posted format=\"%Y\" /></span> <span class=\"archive-month\"><txp:posted format=\"%b\"/></span></a></li>\r\n                </txp:if_different>\r\n            </txp:article_custom>\r\n        </ul>\r\n\r\n        <h4><txp:text item=\"external_links\" /></h4>\r\n        <txp:linklist wraptag=\"ul\" break=\"li\" limit=\"10\" /> <!-- links by default to form: \'plainlinks.link.txp\' unless you specify a different form -->\r\n    </div>\r\n\r\n<!-- footer -->\r\n    <footer role=\"contentinfo\">\r\n        <!-- using PHP to dynamically update the copyright year -->\r\n        <small>&#169;<txp:php>echo date(\'Y\');</txp:php> <txp:site_name />. <txp:text item=\"published_with\" /> <a href=\"http://textpattern.com\" rel=\"external\">Textpattern CMS</a>.</small>\r\n    </footer>\r\n\r\n<!-- JavaScript at the bottom for fast page loading -->\r\n\r\n    <!-- add your own JavaScript here -->\r\n\r\n</body>\r\n</html>')";
$create_sql[] = "INSERT INTO `".PFX."txp_page` VALUES ('error_default', '<!doctype html>\r\n<!--[if lt IE 8]><html class=\"no-js ie7\" lang=\"<txp:lang />\"><![endif]-->\r\n<!--[if IE 8]>   <html class=\"no-js ie8\" lang=\"<txp:lang />\"><![endif]-->\r\n<!--[if gt IE 8]><!--><html class=\"no-js\" lang=\"<txp:lang />\"><!--<![endif]-->\r\n\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n\r\n<!-- page title and metas, no meta keywords as they are now obsolete -->\r\n    <title><txp:site_name />: <txp:error_status /></title>\r\n    <meta name=\"description\" content=\"<txp:error_message />\">\r\n    <meta name=\"robots\" content=\"none\">\r\n\r\n<!-- mobile viewport optimized: j.mp/bplateviewport -->\r\n    <meta name=\"viewport\" content=\"width=device-width,target-densitydpi=160dpi,initial-scale=1\">\r\n\r\n<!-- place favicon.ico and apple-touch-icon.png in the root of your domain and delete these references: mathiasbynens.be/notes/touch-icons -->\r\n    <link rel=\"shortcut icon\" href=\"<txp:site_url />favicon.ico\">\r\n    <link rel=\"apple-touch-icon\" href=\"<txp:site_url />apple-touch-icon.png\">\r\n\r\n<!-- content feeds -->\r\n    <txp:feed_link flavor=\"atom\" format=\"link\" label=\"Atom\" />\r\n    <txp:feed_link flavor=\"rss\" format=\"link\" label=\"RSS\" />\r\n    <txp:rsd />\r\n\r\n<!-- css -->\r\n    <!-- Google font API -->\r\n    <link rel=\"stylesheet\" href=\"http://fonts.googleapis.com/css?family=Droid+Serif:n4,i4,n7,i7|Cousine\">\r\n\r\n    <txp:css format=\"link\" />\r\n    <!-- or you can use external CSS files eg. <link rel=\"stylesheet\" href=\"<txp:site_url />css/default.css\"> -->\r\n\r\n<!-- all JavaScript should go at the bottom, except for Modernizr which enables HTML5 elements & feature detects.\r\n    you should replace this with your own build containing only the tests you actually need via: www.modernizr.com/download/ -->\r\n    <script src=\"<txp:site_url />js/modernizr.js\"></script>\r\n\r\n</head>\r\n\r\n<body id=\"error-page\">\r\n\r\n<!-- header -->\r\n    <header role=\"banner\">\r\n        <hgroup>\r\n            <h1><txp:link_to_home><txp:site_name /></txp:link_to_home></h1>\r\n            <h2><txp:site_slogan /></h2>\r\n        </hgroup>\r\n    </header>\r\n\r\n<!-- navigation -->\r\n    <nav role=\"navigation\" class=\"clearfix\">\r\n        <h1><txp:text item=\"navigation\" /></h1>\r\n        <txp:section_list default_title=\'<txp:text item=\"home\" />\' include_default=\"1\" wraptag=\"ul\" break=\"li\">\r\n            <txp:section link=\"1\" title=\"1\" />\r\n        </txp:section_list>\r\n    </nav>\r\n\r\n<!-- left (main) column -->\r\n    <div role=\"main\">\r\n        <h1 class=\"error-status\"><txp:error_status /></h1>\r\n        <p class=\"error-msg\"><txp:error_message /></p>\r\n    </div>\r\n\r\n<!-- right (complementary) column -->\r\n    <div role=\"complementary\">\r\n        <txp:search_input /> <!-- links by default to form: \'search_input.misc.txp\' unless you specify a different form -->\r\n\r\n        <!-- Feed links, default flavor is rss, so we don\'t need to specify a flavor on the first feed_link -->\r\n        <p><txp:feed_link label=\"RSS\" class=\"feed-rss\" /> / <txp:feed_link flavor=\"atom\" label=\"Atom\" class=\"feed-atom\" /></p>\r\n\r\n        <h4><txp:text item=\"recent_articles\" /></h4>\r\n        <ul id=\"monthly-list\" class=\"clearfix\">\r\n            <!-- using if_different tag to populate list only with months that actually contain articles -->\r\n            <txp:article_custom section=\"articles\" limit=\"12\">\r\n                <txp:if_different>\r\n                    <li><a href=\"<txp:site_url />articles/?month=<txp:posted format=\"%Y-%m\"/>\"><span class=\"archive-year\"><txp:posted format=\"%Y\" /></span> <span class=\"archive-month\"><txp:posted format=\"%b\"/></span></a></li>\r\n                </txp:if_different>\r\n            </txp:article_custom>\r\n        </ul>\r\n\r\n        <h4><txp:text item=\"external_links\" /></h4>\r\n        <txp:linklist wraptag=\"ul\" break=\"li\" limit=\"10\" /> <!-- links by default to form: \'plainlinks.link.txp\' unless you specify a different form -->\r\n    </div>\r\n\r\n<!-- footer -->\r\n    <footer role=\"contentinfo\">\r\n        <!-- using PHP to dynamically update the copyright year -->\r\n        <small>&#169;<txp:php>echo date(\'Y\');</txp:php> <txp:site_name />. <txp:text item=\"published_with\" /> <a href=\"http://textpattern.com\" rel=\"external\">Textpattern CMS</a>.</small>\r\n    </footer>\r\n\r\n<!-- JavaScript at the bottom for fast page loading -->\r\n\r\n    <!-- add your own JavaScript here -->\r\n\r\n</body>\r\n</html>')";
$create_sql[] = "CREATE TABLE `".PFX."txp_plugin` (
  `name` varchar(64) NOT NULL default '',
  `status` int(2) NOT NULL default '1',
  `author` varchar(128) NOT NULL default '',
  `author_uri` varchar(128) NOT NULL default '',
  `version` varchar(10) NOT NULL default '1.0',
  `description` text NOT NULL,
  `help` text NOT NULL,
  `code` text NOT NULL,
  `code_restore` text NOT NULL,
  `code_md5` varchar(32) NOT NULL default '',
  `type` int(2) NOT NULL default '0',
  UNIQUE KEY `name` (`name`)
) $tabletype ";

$create_sql[] = "CREATE TABLE `".PFX."txp_prefs` (
  `prefs_id` int(11) NOT NULL,
  `name` varchar(255) NOT NULL,
  `val` varchar(255) NOT NULL default '',
  `type` smallint(5) unsigned NOT NULL default '2',
  `event` varchar(12) NOT NULL default 'publish',
  `html` varchar(64) NOT NULL default 'text_input',
  `position` smallint(5) unsigned NOT NULL default '0',
  `user_name` varchar(64) NOT NULL default '',
  UNIQUE KEY `prefs_idx` (`prefs_id`,`name`, `user_name`),
  KEY `name` (`name`),
  KEY `user_name` (`user_name`)
) $tabletype ";

$prefs['blog_uid'] = md5(uniqid(rand(),true));
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'prefs_id', '1', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'sitename', '".doSlash(gTxt('my_site'))."', 0, 'publish', 'text_input', 10, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'siteurl', 'comment.local', 0, 'publish', 'text_input', 20, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'site_slogan', '".doSlash(gTxt('my_slogan'))."', 0, 'publish', 'text_input', 30, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'language', 'en-gb', 2, 'publish', 'languages', 40, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'url_mode', '1', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'timeoffset', '0', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_on_default', '0', 0, 'comments', 'yesnoradio', 140, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_default_invite', '".$setup_comment_invite."', 0, 'comments', 'text_input', 180, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_mode', '0', 0, 'comments', 'commentmode', 200, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_disabled_after', '42', 0, 'comments', 'weeks', 210, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'use_textile', '2', 0, 'publish', 'pref_text', 110, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'ping_weblogsdotcom', '0', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'rss_how_many', '5', 1, 'admin', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'logging', 'all', 0, 'publish', 'logging', 100, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'use_comments', '1', 0, 'publish', 'yesnoradio', 120, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'use_categories', '1', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'use_sections', '1', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'send_lastmod', '0', 1, 'admin', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'path_from_root', '/', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'lastmod', '2005-07-23 16:24:10', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_dateformat', '%b %d, %I:%M %p', 0, 'comments', 'dateformats', 190, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'dateformat', 'since', 0, 'publish', 'dateformats', 70, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'archive_dateformat', '%b %d, %I:%M %p', 0, 'publish', 'dateformats', 80, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_moderate', '1', 0, 'comments', 'yesnoradio', 130, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'img_dir', 'images', 1, 'admin', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_disallow_images', '0', 0, 'comments', 'yesnoradio', 170, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_sendmail', '0', 0, 'comments', 'yesnoradio', 160, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'file_max_upload_size', '2000000', 1, 'admin', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'file_list_pageby', '25', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'path_to_site', '', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'article_list_pageby', '25', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'link_list_pageby', '25', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'image_list_pageby', '25', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'log_list_pageby', '25', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comment_list_pageby', '25', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'permlink_mode', '".doSlash($permlink_mode)."', 0, 'publish', 'permlinkmodes', 90, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_are_ol', '1', 0, 'comments', 'yesnoradio', 150, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'is_dst', '0', 0, 'publish', 'yesnoradio', 60, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'locale', 'en_GB.UTF-8', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'tempdir', '".doSlash(find_temp_dir())."', 1, 'admin', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'file_base_path', '".doSlash(dirname(txpath).DS.'files')."', 1, 'admin', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'blog_uid', '". $prefs['blog_uid'] ."', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'blog_mail_uid', '".doSlash(ps('email'))."', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'blog_time_uid', '2005', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'edit_raw_css_by_default', '1', 1, 'css', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'allow_page_php_scripting', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'allow_article_php_scripting', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'allow_raw_php_scripting', '0', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'textile_links', '0', 1, 'link', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'show_article_category_count', '1', 2, 'category', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'show_comment_count_in_feed', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'syndicate_body_or_excerpt', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'include_email_atom', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comment_means_site_updated', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'never_display_email', '0', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_require_name', '1', 1, 'comments', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_require_email', '1', 1, 'comments', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'articles_use_excerpts', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'allow_form_override', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'attach_titles_to_permalinks', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'permalink_title_format', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'expire_logs_after', '7', 1, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'use_plugins', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_1_set', 'custom1', 1, 'custom', 'text_input', 1, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_2_set', 'custom2', 1, 'custom', 'text_input', 2, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_3_set', '', 1, 'custom', 'text_input', 3, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_4_set', '', 1, 'custom', 'text_input', 4, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_5_set', '', 1, 'custom', 'text_input', 5, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_6_set', '', 1, 'custom', 'text_input', 6, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_7_set', '', 1, 'custom', 'text_input', 7, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_8_set', '', 1, 'custom', 'text_input', 8, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_9_set', '', 1, 'custom', 'text_input', 9, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'custom_10_set', '', 1, 'custom', 'text_input', 10, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'ping_textpattern_com', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'use_dns', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'admin_side_plugins', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comment_nofollow', '1', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'use_mail_on_feeds_id', '0', 1, 'publish', 'yesnoradio', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'max_url_len', '200', 1, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'spam_blacklists', 'sbl.spamhaus.org', 1, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'override_emailcharset', '0', 1, 'admin', 'yesnoradio', 21, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'production_status', 'testing', 0, 'publish', 'prod_levels', 210, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'comments_auto_append', '0', 0, 'comments', 'yesnoradio', 211, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'dbupdatetime', '1122194504', 2, 'publish', 'text_input', 0, '')";
$create_sql[] = "INSERT INTO `".PFX."txp_prefs` VALUES (1, 'version', '1.0rc4', 2, 'publish', 'text_input', 0, '')";

$create_sql[] = "CREATE TABLE `".PFX."txp_section` (
  `name` varchar(128) NOT NULL,
  `page` varchar(128) NOT NULL default '',
  `css` varchar(128) NOT NULL default '',
  `is_default` int(2) NOT NULL default '0',
  `in_rss` int(2) NOT NULL default '1',
  `on_frontpage` int(2) NOT NULL default '1',
  `searchable` int(2) NOT NULL default '1',
  `title` varchar(255) NOT NULL default '',
  PRIMARY KEY (`name`)
) $tabletype PACK_KEYS=1";

$create_sql[] = "INSERT INTO `".PFX."txp_section` VALUES ('articles', 'archive', 'default', 1, 1, 1, 1, 'Articles')";
$create_sql[] = "INSERT INTO `".PFX."txp_section` VALUES ('default', 'default', 'default', 0, 1, 1, 1, 'default')";
$create_sql[] = "INSERT INTO `".PFX."txp_section` VALUES ('about', 'default', 'default', 0, 0, 0, 1, 'About')";

$create_sql[] = "CREATE TABLE `".PFX."txp_users` (
  `user_id` int(4) NOT NULL auto_increment,
  `name` varchar(64) NOT NULL default '',
  `pass` varchar(128) NOT NULL default '',
  `RealName` varchar(64) NOT NULL default '',
  `email` varchar(100) NOT NULL default '',
  `privs` tinyint(2) NOT NULL default '1',
  `last_access` datetime NOT NULL default '0000-00-00 00:00:00',
  `nonce` varchar(64) NOT NULL default '',
  PRIMARY KEY  (`user_id`),
  UNIQUE KEY `name` (`name`)
) $tabletype PACK_KEYS=1 AUTO_INCREMENT=2 ";


$GLOBALS['txp_install_successful'] = true;
$GLOBALS['txp_err_count'] = 0;
foreach ($create_sql as $query)
{
	$result = mysql_query($query);
	if (!$result)
	{
		$GLOBALS['txp_err_count']++;
		echo "<b>".$GLOBALS['txp_err_count'].".</b> ".mysql_error()."<br />\n";
		echo "<!--\n $query \n-->\n";
		$GLOBALS['txp_install_successful'] = false;
	}
}

# Skip the RPC language fetch when testing
if (defined('TXP_TEST'))
	return;

require_once txpath.'/lib/IXRClass.php';
$client = new IXR_Client('http://rpc.textpattern.com');

if (!$client->query('tups.getLanguage',$prefs['blog_uid'],LANG))
{
	# If cannot install from lang file, setup the english lang
	if (!install_language_from_file(LANG))
	{
		$lang = 'en-gb';
		include_once txpath.'/setup/en-gb.php';
		if (!@$lastmod) $lastmod = '0000-00-00 00:00:00';
		foreach ($en_gb_lang as $evt_name => $evt_strings)
		{
			foreach ($evt_strings as $lang_key => $lang_val)
			{
				$lang_val = doSlash($lang_val);
				if (@$lang_val)
					mysql_query("INSERT DELAYED INTO `".PFX."txp_lang` SET lang='en-gb', name='".$lang_key."', event='".$evt_name."', data='".$lang_val."', lastmod='".$lastmod."'");
			}
		}
	}
}
else
{
	$response = $client->getResponse();
	$lang_struct = unserialize($response);
	foreach ($lang_struct as $item)
	{
		foreach ($item as $name => $value)
			$item[$name] = doSlash($value);
		mysql_query("INSERT DELAYED INTO `".PFX."txp_lang` SET lang='".LANG."', name='".$item['name']."', event='".$item['event']."', data='".$item['data']."', lastmod='".strftime('%Y%m%d%H%M%S',$item['uLastmod'])."'");
	}
}

mysql_query("FLUSH TABLE `".PFX."txp_lang`");

?>
